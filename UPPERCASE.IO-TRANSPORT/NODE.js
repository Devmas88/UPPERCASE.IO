global.MULTI_PROTOCOL_SOCKET_SERVER=MULTI_PROTOCOL_SOCKET_SERVER=METHOD({run:function(_,E){"use strict";var o=_.socketServerPort,e=_.webSocketServerPort,t=_.webServer;void 0!==o&&SOCKET_SERVER(o,E),(void 0!==e||void 0!==t)&&WEB_SOCKET_SERVER(void 0!==e?e:t,E)}}),global.WEB_SOCKET_FIX_SERVER=WEB_SOCKET_FIX_SERVER=METHOD(function(){"use strict";var _=5,E=2;return{run:function(o,e){var t={},n={},d=0,i={},a={},R={},C={},S=function(_,E,o,e){void 0===t[_]&&(t[_]={}),void 0===t[_][E]?t[_][E]=o:t[_][E]+=o,e===!0&&void 0!==CPU_CLUSTERING.broadcast&&CPU_CLUSTERING.broadcast({methodName:"__WEB_SOCKET_FIX_SERVER__ADD_CONTENT",data:{clientId:_,requestKey:E,content:o}})},c=function(_,E,o){void 0!==t[_]&&delete t[_][E],o===!0&&void 0!==CPU_CLUSTERING.broadcast&&CPU_CLUSTERING.broadcast({methodName:"__WEB_SOCKET_FIX_SERVER__REMOVE_CONTENT",data:{clientId:_,requestKey:E}})},T=function(_,E){void 0!==i[_]?i[_](E):N(_,E,!0)},r=function(_,E,o,e){var t=n[_][E];void 0!==t&&EACH(t,function(E){E(o,function(E){void 0!==e&&T(_,{methodName:"__CALLBACK_"+e,data:E})})})},v=function(_){void 0!==R[_]&&(R[_].remove(),delete R[_]),delete i[_]},N=function(_,E,o){void 0===a[_]&&(a[_]=[]),a[_].push(E),o===!0&&void 0!==CPU_CLUSTERING.broadcast&&CPU_CLUSTERING.broadcast({methodName:"__WEB_SOCKET_FIX_SERVER__SEND",data:{clientId:_,params:E}})},I=function(_,E){REMOVE({data:a[_],key:0}),0===a[_].length&&delete a[_],E===!0&&void 0!==CPU_CLUSTERING.broadcast&&CPU_CLUSTERING.broadcast({methodName:"__WEB_SOCKET_FIX_SERVER__REMOVE_FIRST_WATING_PARAMS",data:_})},O=function(_,E){void 0!==C[_]&&(C[_].remove(),delete C[_]),E===!0&&void 0!==CPU_CLUSTERING.broadcast&&CPU_CLUSTERING.broadcast({methodName:"__WEB_SOCKET_FIX_SERVER__REMOVE_LIFE_DELAY",data:_})},u=function(_,E){v(_),void 0!==n[_]&&delete n[_],void 0!==a[_]&&delete a[_],O(_),void 0!==t[_]&&delete t[_],E===!0&&void 0!==CPU_CLUSTERING.broadcast&&CPU_CLUSTERING.broadcast({methodName:"__WEB_SOCKET_FIX_SERVER__REMOVE_ALL",data:_})};void 0!==CPU_CLUSTERING.on&&(CPU_CLUSTERING.on("__WEB_SOCKET_FIX_SERVER__RUN_METHODS",function(_){var E=_.clientId;void 0!==n[E]&&r(E,_.methodName,_.data,_.sendKey)}),CPU_CLUSTERING.on("__WEB_SOCKET_FIX_SERVER__REMOVE_FIRST_WATING_PARAMS",function(_){void 0!==a[_]&&I(_)}),CPU_CLUSTERING.on("__WEB_SOCKET_FIX_SERVER__SEND",function(_){var E=_.clientId,o=_.params;void 0!==i[E]?(i[E](o),void 0!==CPU_CLUSTERING.broadcast&&CPU_CLUSTERING.broadcast({methodName:"__WEB_SOCKET_FIX_SERVER__REMOVE_FIRST_WATING_PARAMS",data:E})):N(E,o)}),CPU_CLUSTERING.on("__WEB_SOCKET_FIX_SERVER__REMOVE_LIFE_DELAY",function(_){O(_)}),CPU_CLUSTERING.on("__WEB_SOCKET_FIX_SERVER__REMOVE_ALL",function(_){u(_)}),CPU_CLUSTERING.on("__WEB_SOCKET_FIX_SERVER__ADD_CONTENT",function(_){S(_.clientId,_.requestKey,_.content)}),CPU_CLUSTERING.on("__WEB_SOCKET_FIX_SERVER__REMOVE_CONTENT",function(_){c(_.clientId,_.requestKey)})),WEB_SERVER(o,function(o,N,s){var U,K,L,f=o.params,V=f.clientId,l=INTEGER(f.connectionKey),P=INTEGER(f.requestKey),A=f.content,m="true"===f.isEnd,B=function(_,E,o){void 0!==n[V]?r(V,_,E):void 0!==CPU_CLUSTERING.broadcast&&CPU_CLUSTERING.broadcast({methodName:"__WEB_SOCKET_FIX_SERVER__RUN_METHODS",data:{clientId:V,methodName:_,data:E,sendKey:o}}),"__DISCONNECTED"===_&&u(V,!0)};void 0===V?(V=RANDOM_STR(40),U=n[V]={},e({ip:o.ip,headers:o.headers},K=function(_,E){var o=U[_];void 0===o&&(o=U[_]=[]),o.push(E)},L=function(_,E){var o=U[_];void 0!==o&&(void 0!==E?REMOVE({data:o,value:E}):delete U[_])},function(_,E){_.sendKey=d,d+=1,T(V,_),void 0!==E&&K("__CALLBACK_"+d,function(_){E(_),L("__CALLBACK_"+d)})},function(){B("__DISCONNECTED")}),N({contentType:"application/javascript",content:"CONNECT_TO_WEB_SOCKET_SERVER.response('"+STRINGIFY({clientId:V,connectionKey:l,requestKey:P})+"')"})):m===!0?(RUN(function(){var o,e=void 0===t[V]?void 0:PARSE_STR(t[V][P]),n=void 0===e?void 0:e.methodName,d=void 0===e?void 0:e.data,S=void 0===e?void 0:e.sendKey;void 0!==n?(B(n,d,S),N({contentType:"application/javascript",content:"CONNECT_TO_WEB_SOCKET_SERVER.removeRequestInfo("+P+")"})):void 0!==i[V]?i[V]():(O(V,!0),o=function(){B("__DISCONNECTED")},i[V]=function(_){N({contentType:"application/javascript",content:"CONNECT_TO_WEB_SOCKET_SERVER.response('"+STRINGIFY({connectionKey:l,clientId:V,params:_,requestKey:P})+"')"}),v(V),C[V]=DELAY(E,o)},s(o),R[V]=DELAY(_,function(){void 0!==i[V]&&i[V]()}),void 0!==a[V]&&(i[V](a[V][0]),I(V,!0)))}),c(V,P,!0)):(S(V,P,A,!0),N({contentType:"application/javascript",content:"CONNECT_TO_WEB_SOCKET_SERVER.request("+P+")"}))}),console.log("[UPPERCASE.IO-WEB_SOCKET_FIX_SERVER] RUNNING WEB SOCKET FIX SERVER... (PORT:"+o+")")}}}),global.WEB_SOCKET_SERVER=WEB_SOCKET_SERVER=METHOD({run:function(_,E){"use strict";var o,e,t,n=require("ws").Server;CHECK_IS_DATA(_)!==!0?o=_:e=_,t=new n({port:o,server:void 0===e?void 0:e.getNativeHTTPServer()}),t.on("connection",function(_){var o,e,t,n,d,i=_.upgradeReq.headers,a={},R=0,C=function(_,E,o){var e=a[_];void 0!==e&&EACH(e,function(_){_(E,function(_){void 0!==o&&d({methodName:"__CALLBACK_"+o,data:_})})})};_.on("message",function(_){var E=PARSE_STR(_);void 0!==E&&C(E.methodName,E.data,E.sendKey)}),_.on("close",function(){e!==!0&&C("__DISCONNECTED"),a=void 0}),_.on("error",function(_){C("__ERROR",_)}),o=i["x-forwarded-for"],void 0===o&&(o=_.upgradeReq.connection.remoteAddress),E({ip:o,headers:i},t=function(_,E){var o=a[_];void 0===o&&(o=a[_]=[]),o.push(E)},n=function(_,E){var o=a[_];void 0!==o&&(void 0!==E?REMOVE({data:o,value:E}):delete a[_])},d=function(E,o){E.sendKey=R,R+=1,_.send(STRINGIFY(E)),void 0!==o&&t("__CALLBACK_"+R,function(_){o(_),n("__CALLBACK_"+R)})},function(){e=!0,_.close()})}),console.log("[UPPERCASE.IO-WEB_SOCKET_SERVER] RUNNING WEB SOCKET SERVER..."+(void 0===o?"":" (PORT:"+o+")"))}});