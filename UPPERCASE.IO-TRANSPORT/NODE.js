global.MULTI_PROTOCOL_SOCKET_SERVER=MULTI_PROTOCOL_SOCKET_SERVER=METHOD({run:function(_,E){"use strict";var o=_.socketServerPort,e=_.webSocketServerPort,t=_.webSocketFixServerPort;SOCKET_SERVER(o,E),WEB_SOCKET_SERVER({port:e,fixServerPort:t},E)}}),global.WEB_SOCKET_FIX_SERVER=WEB_SOCKET_FIX_SERVER=METHOD(function(){"use strict";var _=5,E=2;return{run:function(o,e){var t={},n={},d=0,i={},R={},a={},S={},C=function(_,E,o,e){void 0===t[_]&&(t[_]={}),void 0===t[_][E]?t[_][E]=o:t[_][E]+=o,e===!0&&void 0!==CPU_CLUSTERING.broadcast&&CPU_CLUSTERING.broadcast({methodName:"__WEB_SOCKET_FIX_SERVER__ADD_CONTENT",data:{clientId:_,requestKey:E,content:o}})},c=function(_,E,o){void 0!==t[_]&&delete t[_][E],o===!0&&void 0!==CPU_CLUSTERING.broadcast&&CPU_CLUSTERING.broadcast({methodName:"__WEB_SOCKET_FIX_SERVER__REMOVE_CONTENT",data:{clientId:_,requestKey:E}})},T=function(_,E){void 0!==i[_]?i[_](E):I(_,E,!0)},r=function(_,E,o,e){var t=n[_][E];void 0!==t&&EACH(t,function(E){E(o,function(E){void 0!==e&&T(_,{methodName:"__CALLBACK_"+e,data:E})})})},v=function(_){void 0!==a[_]&&(a[_].remove(),delete a[_]),delete i[_]},I=function(_,E,o){void 0===R[_]&&(R[_]=[]),R[_].push(E),o===!0&&void 0!==CPU_CLUSTERING.broadcast&&CPU_CLUSTERING.broadcast({methodName:"__WEB_SOCKET_FIX_SERVER__SEND",data:{clientId:_,params:E}})},N=function(_,E){REMOVE({data:R[_],key:0}),0===R[_].length&&delete R[_],E===!0&&void 0!==CPU_CLUSTERING.broadcast&&CPU_CLUSTERING.broadcast({methodName:"__WEB_SOCKET_FIX_SERVER__REMOVE_FIRST_WATING_PARAMS",data:_})},O=function(_,E){void 0!==S[_]&&(S[_].remove(),delete S[_]),E===!0&&void 0!==CPU_CLUSTERING.broadcast&&CPU_CLUSTERING.broadcast({methodName:"__WEB_SOCKET_FIX_SERVER__REMOVE_LIFE_DELAY",data:_})},u=function(_,E){v(_),void 0!==n[_]&&delete n[_],void 0!==R[_]&&delete R[_],O(_),void 0!==t[_]&&delete t[_],E===!0&&void 0!==CPU_CLUSTERING.broadcast&&CPU_CLUSTERING.broadcast({methodName:"__WEB_SOCKET_FIX_SERVER__REMOVE_ALL",data:_})};void 0!==CPU_CLUSTERING.on&&(CPU_CLUSTERING.on("__WEB_SOCKET_FIX_SERVER__RUN_METHODS",function(_){var E=_.clientId;void 0!==n[E]&&r(E,_.methodName,_.data,_.sendKey)}),CPU_CLUSTERING.on("__WEB_SOCKET_FIX_SERVER__REMOVE_FIRST_WATING_PARAMS",function(_){void 0!==R[_]&&N(_)}),CPU_CLUSTERING.on("__WEB_SOCKET_FIX_SERVER__SEND",function(_){var E=_.clientId,o=_.params;void 0!==i[E]?(i[E](o),void 0!==CPU_CLUSTERING.broadcast&&CPU_CLUSTERING.broadcast({methodName:"__WEB_SOCKET_FIX_SERVER__REMOVE_FIRST_WATING_PARAMS",data:E})):I(E,o)}),CPU_CLUSTERING.on("__WEB_SOCKET_FIX_SERVER__REMOVE_LIFE_DELAY",function(_){O(_)}),CPU_CLUSTERING.on("__WEB_SOCKET_FIX_SERVER__REMOVE_ALL",function(_){u(_)}),CPU_CLUSTERING.on("__WEB_SOCKET_FIX_SERVER__ADD_CONTENT",function(_){C(_.clientId,_.requestKey,_.content)}),CPU_CLUSTERING.on("__WEB_SOCKET_FIX_SERVER__REMOVE_CONTENT",function(_){c(_.clientId,_.requestKey)})),WEB_SERVER(o,function(o,I,s){var U,K,f,L=o.params,V=L.clientId,P=INTEGER(L.connectionKey),l=INTEGER(L.requestKey),A=L.content,m="true"===L.isEnd,B=function(_,E,o){void 0!==n[V]?r(V,_,E):void 0!==CPU_CLUSTERING.broadcast&&CPU_CLUSTERING.broadcast({methodName:"__WEB_SOCKET_FIX_SERVER__RUN_METHODS",data:{clientId:V,methodName:_,data:E,sendKey:o}}),"__DISCONNECTED"===_&&u(V,!0)};void 0===V?(V=RANDOM_STR(40),U=n[V]={},e({ip:o.ip,headers:o.headers},K=function(_,E){var o=U[_];void 0===o&&(o=U[_]=[]),o.push(E)},f=function(_,E){var o=U[_];void 0!==o&&(void 0!==E?REMOVE({data:o,value:E}):delete U[_])},function(_,E){_.sendKey=d,d+=1,T(V,_),void 0!==E&&K("__CALLBACK_"+d,function(_){E(_),f("__CALLBACK_"+d)})},function(){B("__DISCONNECTED")}),I({contentType:"application/javascript",content:"CONNECT_TO_WEB_SOCKET_SERVER.response('"+STRINGIFY({clientId:V,connectionKey:P,requestKey:l})+"')"})):m===!0?(RUN(function(){var o,e=void 0===t[V]?void 0:PARSE_STR(t[V][l]),n=void 0===e?void 0:e.methodName,d=void 0===e?void 0:e.data,C=void 0===e?void 0:e.sendKey;void 0!==n?(B(n,d,C),I({contentType:"application/javascript",content:"CONNECT_TO_WEB_SOCKET_SERVER.removeRequestInfo("+l+")"})):void 0!==i[V]?i[V]():(O(V,!0),o=function(){B("__DISCONNECTED")},i[V]=function(_){I({contentType:"application/javascript",content:"CONNECT_TO_WEB_SOCKET_SERVER.response('"+STRINGIFY({connectionKey:P,clientId:V,params:_,requestKey:l})+"')"}),v(V),S[V]=DELAY(E,o)},s(o),a[V]=DELAY(_,function(){void 0!==i[V]&&i[V]()}),void 0!==R[V]&&(i[V](R[V][0]),N(V,!0)))}),c(V,l,!0)):(C(V,l,A,!0),I({contentType:"application/javascript",content:"CONNECT_TO_WEB_SOCKET_SERVER.request("+l+")"}))}),console.log("[UPPERCASE.IO-WEB_SOCKET_FIX_SERVER] RUNNING WEB SOCKET FIX SERVER... (PORT:"+o+")")}}}),global.WEB_SOCKET_SERVER=WEB_SOCKET_SERVER=METHOD({run:function(_,E){"use strict";var o,e,t,n=require("ws").Server;CHECK_IS_DATA(_)===!0?(o=_.port,e=_.fixServerPort):o=_,t=new n({port:o}),t.on("connection",function(_){var o,e,t,n,d,i=_.upgradeReq.headers,R={},a=0,S=function(_,E,o){var e=R[_];void 0!==e&&EACH(e,function(_){_(E,function(_){void 0!==o&&d({methodName:"__CALLBACK_"+o,data:_})})})};_.on("message",function(_){var E=PARSE_STR(_);void 0!==E&&S(E.methodName,E.data,E.sendKey)}),_.on("close",function(){e!==!0&&S("__DISCONNECTED"),R=void 0}),_.on("error",function(_){S("__ERROR",_)}),o=i["x-forwarded-for"],void 0===o&&(o=_.upgradeReq.connection.remoteAddress),E({ip:o,headers:i},t=function(_,E){var o=R[_];void 0===o&&(o=R[_]=[]),o.push(E)},n=function(_,E){var o=R[_];void 0!==o&&(void 0!==E?REMOVE({data:o,value:E}):delete R[_])},d=function(E,o){E.sendKey=a,a+=1,_.send(STRINGIFY(E)),void 0!==o&&t("__CALLBACK_"+a,function(_){o(_),n("__CALLBACK_"+a)})},function(){e=!0,_.close()})}),console.log("[UPPERCASE.IO-WEB_SOCKET_SERVER] RUNNING WEB SOCKET SERVER... (PORT:"+o+")"),void 0!==e&&WEB_SOCKET_FIX_SERVER(e,E)}});