global.NODE_CONFIG=NODE_CONFIG={},global.CPU_CLUSTERING=CPU_CLUSTERING=METHOD(function(t){"use strict";var e=require("cluster");return{run:function(o){RUN(e.isMaster?function(){var t=function(){var t=e.fork();t.on("message",function(o){EACH(e.workers,function(e){e!==t&&e.send(o)})})};REPEAT(require("os").cpus().length,function(){t()}),e.on("exit",function(e,o,n){console.log(CONSOLE_RED("[UPPERCASE.JS-CPU_CLUSTERING] WORKER #"+e.id+" (PID:"+e.process.pid+") died. ("+(void 0!==n?n:o)+"). restarting...")),t()})}:function(){var n,E,r,i=e.worker.id,a=e.worker.process.pid,R={},u=function(t,e){var o=R[t];void 0!==o&&EACH(o,function(t){t(e)})};process.on("message",function(t){var e=PARSE_STR(t);void 0!==e&&u(e.methodName,e.data)}),t.on=n=function(t,e){var o=R[t];void 0===o&&(o=R[t]=[]),o.push(e)},n("__SHARED_STORE_SAVE",SHARED_STORE.save),n("__SHARED_STORE_REMOVE",SHARED_STORE.remove),n("__CPU_SHARED_STORE_SAVE",CPU_SHARED_STORE.save),n("__CPU_SHARED_STORE_REMOVE",CPU_SHARED_STORE.remove),t.off=E=function(t){delete R[t]},t.broadcast=r=function(t){process.send(STRINGIFY(t))},o({id:i,pid:a},n,E,r),console.log(CONSOLE_GREEN("[UPPERCASE.JS-CPU_CLUSTERING] RUNNING WORKER... (ID:"+i+", PID:"+a+")"))})}}}),global.CPU_SHARED_STORE=CPU_SHARED_STORE=CLASS(function(t){"use strict";var e,o,n,E={},r={};return t.save=e=function(t,e){var o=t.fullKey,n=t.value,i=t.removeAfterSeconds,a=t.isWaitRemove;E[o]=n,a===!0&&void 0!==r[o]&&(r[o].remove(),delete r[o]),void 0!==i&&(r[o]=DELAY(i,e))},t.get=o=function(t){return E[t]},t.remove=n=function(t){delete E[t],void 0!==r[t]&&(r[t].remove(),delete r[t])},{init:function(e,o,n){var E,r,i,a;E=function(t){return n+"."+t},o.save=r=function(e){var o=e.key,n=E(o),r=e.value,i=e.removeAfterSeconds;t.save({fullKey:n,value:r,removeAfterSeconds:i},function(){a(o)}),void 0!==CPU_CLUSTERING.broadcast&&CPU_CLUSTERING.broadcast({methodName:"__CPU_SHARED_STORE_SAVE",data:{fullKey:n,value:r,isWaitRemove:void 0!==i}})},o.get=i=function(e){return t.get(E(e))},o.remove=a=function(e){var o=E(e);t.remove(o),void 0!==CPU_CLUSTERING.broadcast&&CPU_CLUSTERING.broadcast({methodName:"__CPU_SHARED_STORE_REMOVE",data:o})}}}}),global.SERVER_CLUSTERING=SERVER_CLUSTERING=METHOD(function(t){"use strict";return{run:function(e,o){var n,E,r,i,a,R=require("os"),u=e.hosts,s=e.port,c=R.networkInterfaces(),S=[],_={},d={},C={},T=[];EACH(c,function(t){return EACH(t,function(t){var e=t.address;return"IPv4"===t.family&&t.internal===!1&&(S.push(e),CHECK_IS_EXISTS({data:u,value:e})===!0)?(n=e,!1):void 0})}),void 0===n?console.log(CONSOLE_YELLOW("[UPPERCASE.JS-SERVER_CLUSTERING] NOT EXISTS MY HOST. (CLUSTER SERVER HOSTS:"),u,CONSOLE_YELLOW(", THIS SERVER HOSTS:"),S):(E=function(t){d[t]!==!0&&(d[t]=!0,CONNECT_TO_SOCKET_SERVER({host:t,port:s},{error:function(){delete d[t]},success:function(e,o,E){E({methodName:"__BOOTED",data:n}),C[t]=function(t){var e=t.methodName,o=t.data;E({methodName:"SERVER_CLUSTERING."+e,data:o})},e("__DISCONNECTED",function(){delete C[t],delete d[t]}),console.log("[UPPERCASE.JS-SERVER_CLUSTERING] CONNECTED CLUSTERING SERVER. (HOST:"+t+")"),void 0!==CPU_CLUSTERING.broadcast&&CPU_CLUSTERING.broadcast({methodName:"__SERVER_CLUSTERING__CONNECT_TO_CLUSTERING_SERVER",data:t})}}))},void 0!==CPU_CLUSTERING.on&&CPU_CLUSTERING.on("__SERVER_CLUSTERING__CONNECT_TO_CLUSTERING_SERVER",E),EACH(u,function(t){t!==n&&E(t)}),SOCKET_SERVER(s,function(t,e){T.push(e),e("__BOOTED",function(t){E(t)}),EACH(_,function(t,o){EACH(t,function(t){e("SERVER_CLUSTERING."+o,t)})}),e("__DISCONNECTED",function(){REMOVE({data:T,value:e})})}),t.on=r=function(t,e){var o=_[t];void 0===o&&(o=_[t]=[]),o.push(e),EACH(T,function(o){o("SERVER_CLUSTERING."+t,e)})},r("__SHARED_STORE_SAVE",function(t){SHARED_STORE.save(t),void 0!==CPU_CLUSTERING.broadcast&&CPU_CLUSTERING.broadcast({methodName:"__SHARED_STORE_SAVE",data:t})}),r("__SHARED_STORE_REMOVE",function(t){SHARED_STORE.remove(t),void 0!==CPU_CLUSTERING.broadcast&&CPU_CLUSTERING.broadcast({methodName:"__SHARED_STORE_REMOVE",data:t})}),t.off=i=function(t){delete _[t]},t.broadcast=a=function(t){EACH(C,function(e){e(t)})},void 0!==o&&o(n,r,i,a),console.log(CONSOLE_BLUE("[UPPERCASE.JS-SERVER_CLUSTERING] RUNNING CLUSTERING SERVER... (THIS SERVER HOST:"+n+", PORT:"+s+")")))}}}),global.SHARED_STORE=SHARED_STORE=CLASS(function(t){"use strict";var e,o,n,E={},r={};return t.save=e=function(t,e){var o=t.fullKey,n=t.value,i=t.removeAfterSeconds,a=t.isWaitRemove;E[o]=n,a===!0&&void 0!==r[o]&&(r[o].remove(),delete r[o]),void 0!==i&&(r[o]=DELAY(i,e))},t.get=o=function(t){return E[t]},t.remove=n=function(t){delete E[t],void 0!==r[t]&&(r[t].remove(),delete r[t])},{init:function(e,o,n){var E,r,i,a;E=function(t){return n+"."+t},o.save=r=function(e){var o=e.key,n=E(o),r=e.value,i=e.removeAfterSeconds;t.save({fullKey:n,value:r,removeAfterSeconds:i},function(){a(o)}),void 0!==CPU_CLUSTERING.broadcast&&CPU_CLUSTERING.broadcast({methodName:"__SHARED_STORE_SAVE",data:{fullKey:n,value:r,isWaitRemove:void 0!==i}}),void 0!==SERVER_CLUSTERING.broadcast&&SERVER_CLUSTERING.broadcast({methodName:"__SHARED_STORE_SAVE",data:{fullKey:n,value:r,isWaitRemove:void 0!==i}})},o.get=i=function(e){return t.get(E(e))},o.remove=a=function(e){var o=E(e);t.remove(o),void 0!==CPU_CLUSTERING.broadcast&&CPU_CLUSTERING.broadcast({methodName:"__SHARED_STORE_REMOVE",data:o}),void 0!==SERVER_CLUSTERING.broadcast&&SERVER_CLUSTERING.broadcast({methodName:"__SHARED_STORE_REMOVE",data:o})}}}}),global.CONNECT_TO_SOCKET_SERVER=CONNECT_TO_SOCKET_SERVER=METHOD({run:function(t,e){"use strict";var o,n,E,r,i,a,R,u,s,c=t.host,S=t.port,_=require("net"),d={},C="";CHECK_IS_DATA(e)!==!0?o=e:(o=e.success,n=e.error),s=function(t,e){var o=d[t];void 0!==o&&EACH(o,function(o){o(e,function(e){void 0!==u&&u({methodName:"__CALLBACK_"+t,data:e})})})},E=_.connect({host:c,port:S},function(){r=!0,o(a=function(t,e){var o=d[t];void 0===o&&(o=d[t]=[]),o.push(e)},R=function(t,e){var o=d[t];void 0!==o&&(void 0!==e?REMOVE({data:o,value:e}):delete d[t])},u=function(t,e){var o=t.methodName;E.write(STRINGIFY(t)+"\n"),void 0!==e&&a("__CALLBACK_"+o,function(t){e(t),R("__CALLBACK_"+o)})},function(){i=!0,E.end()})}),E.on("data",function(t){var e,o,n;for(C+=t.toString();-1!==(o=C.indexOf("\n"));)e=C.substring(0,o),n=PARSE_STR(e),void 0!==n&&s(n.methodName,n.data),C=C.substring(o+1)}),E.on("close",function(){i!==!0&&s("__DISCONNECTED")}),E.on("error",function(t){var e=t.toString();r!==!0?(console.log(CONSOLE_RED("[UPPERCASE.JS-CONNECT_TO_SOCKET_SERVER] CONNECT TO SOCKET SERVER FAILED: "+e)),void 0!==n&&n(e)):s("__ERROR",e)})}}),global.CONSOLE_BLUE=CONSOLE_BLUE=METHOD({run:function(t){"use strict";return"[36m"+t+"[0m"}}),global.CONSOLE_GREEN=CONSOLE_GREEN=METHOD({run:function(t){"use strict";return"[32m"+t+"[0m"}}),global.CONSOLE_RED=CONSOLE_RED=METHOD({run:function(t){"use strict";return"[31m"+t+"[0m"}}),global.CONSOLE_YELLOW=CONSOLE_YELLOW=METHOD({run:function(t){"use strict";return"[33m"+t+"[0m"}}),global.SHA1=SHA1=METHOD({run:function(t){"use strict";var e=t.key,o=t.password,n=require("crypto");return n.createHmac("sha1",e).update(o).digest("hex")}}),global.COPY_FILE=COPY_FILE=METHOD(function(){"use strict";var t=require("fs"),e=require("path");return{run:function(o,n){var E,r,i=o.srcPath,a=o.distPath;CHECK_IS_DATA(n)!==!0?E=n:(E=n.success,r=n.error),CREATE_FOLDER(e.dirname(a),function(){var e=t.createReadStream(i);e.pipe(t.createWriteStream(a)),e.on("error",function(t){var e=t.toString();console.log(CONSOLE_RED("[UPPERCASE.JS-COPY_FILE] ERROR:"+e)),void 0!==r&&r(e)}),e.on("end",function(){E()})})}}}),global.CREATE_FOLDER=CREATE_FOLDER=METHOD(function(){"use strict";var t=require("fs"),e=require("path");return{run:function(o,n){t.exists(o,function(E){var r;E===!0?n():(r=e.dirname(o),t.exists(r,function(e){e===!0?t.mkdir(o,n):CREATE_FOLDER(r,function(){CREATE_FOLDER(o,n)})}))})}}}),global.MOVE_FILE=MOVE_FILE=METHOD({run:function(t,e){"use strict";var o,n,E=t.srcPath;CHECK_IS_DATA(e)!==!0?o=e:(o=e.success,n=e.error),COPY_FILE(t,{error:n,success:function(){REMOVE_FILE(E,{error:n,success:o})}})}}),global.READ_FILE=READ_FILE=METHOD(function(){"use strict";var t=require("fs");return{run:function(e,o){var n,E,r;CHECK_IS_DATA(o)!==!0?n=o:(n=o.success,E=o.notExists,r=o.error),t.exists(e,function(o){o===!0?t.stat(e,function(o,i){var a;o!==TO_DELETE?(a=o.toString(),console.log(CONSOLE_RED("[UPPERCASE.JS-READ_FILE] ERROR: "+a)),void 0!==r&&r(a)):i.isDirectory()===!0?void 0!==E&&E(e):t.readFile(e,function(t,e){var o;t!==TO_DELETE?(o=t.toString(),console.log(CONSOLE_RED("[UPPERCASE.JS-READ_FILE] ERROR: "+o)),void 0!==r&&r(o)):n(e)})}):void 0!==E&&E(e)})}}}),global.REMOVE_FILE=REMOVE_FILE=METHOD(function(){"use strict";var t=require("fs");return{run:function(e,o){var n,E,r;CHECK_IS_DATA(o)!==!0?n=o:(n=o.success,E=o.notExists,r=o.error),t.exists(e,function(o){o===!0?t.unlink(e,function(t){var e;t!==TO_DELETE?(e=t.toString(),console.log(CONSOLE_RED("[UPPERCASE.JS-REMOVE_FILE] ERROR: "+e)),void 0!==r&&r(e)):void 0!==n&&n()}):void 0!==E&&E(e)})}}}),global.WRITE_FILE=WRITE_FILE=METHOD(function(){"use strict";var t=require("fs"),e=require("path");return{run:function(o,n){var E,r,i=o.path,a=o.content;CHECK_IS_DATA(n)!==!0?E=n:(E=n.success,r=n.error),CREATE_FOLDER(e.dirname(i),function(){t.writeFile(i,a,function(t){var e;t!==TO_DELETE?(e=t.toString(),console.log(CONSOLE_RED("[UPPERCASE.JS-WRITE_FILE] ERROR:"+e)),void 0!==r&&r(e)):E()})})}}}),global.DELETE=DELETE=METHOD({run:function(t,e){"use strict";REQUEST(COMBINE_DATA({origin:CHECK_IS_DATA(t)===!0?t:{uri:t},extend:{method:"DELETE"}}),e)}}),global.GET=GET=METHOD({run:function(t,e){"use strict";REQUEST(COMBINE_DATA({origin:CHECK_IS_DATA(t)===!0?t:{uri:t},extend:{method:"GET"}}),e)}}),global.POST=POST=METHOD({run:function(t,e){"use strict";REQUEST(COMBINE_DATA({origin:CHECK_IS_DATA(t)===!0?t:{uri:t},extend:{method:"POST"}}),e)}}),global.PUT=PUT=METHOD({run:function(t,e){"use strict";REQUEST(COMBINE_DATA({origin:CHECK_IS_DATA(t)===!0?t:{uri:t},extend:{method:"PUT"}}),e)}}),global.REQUEST=REQUEST=METHOD({run:function(t,e){"use strict";var o,n,E,r=require("http"),i=void 0===t.host?"localhost":t.host,a=void 0===t.port?80:t.port,R=t.method,u=t.uri,s=void 0!==t.data?"data="+encodeURIComponent(STRINGIFY(t.data)):t.paramStr;CHECK_IS_DATA(e)!==!0?o=e:(o=e.success,n=e.error),s=(void 0===s?"":s+"&")+Date.now(),R=R.toUpperCase(),"GET"===R?E=r.get({hostname:i,port:a,path:"/"+u+"?"+s},function(t){t.setEncoding("utf-8"),t.on("data",function(t){o(t)})}):(E=r.request({hostname:i,port:a,path:"/"+u,method:R},function(t){t.setEncoding("utf-8"),t.on("data",function(t){o(t)})}),E.write(s),E.end()),E.on("error",function(e){var o=e.toString();console.log(CONSOLE_RED("[UPPERCASE.JS-NODE] REQUEST FAILED: "+o),t),void 0!==n&&n(o)})}}),global.RESOURCE_SERVER=RESOURCE_SERVER=METHOD(function(t){"use strict";var e,o=require("path"),n=require("querystring");return t.getContentTypeFromURI=e=function(t){var e=o.extname(t);return".png"===e?"image/png":".jpeg"===e||".jpg"===e?"image/jpeg":".gif"===e?"image/gif":".js"===e?"text/javascript":".json"===e?"application/json":".css"===e?"text/css":".text"===e||".txt"===e?"text/plain":".html"===e?"text/html":".swf"===e?"application/x-shockwave-flash":".mp3"===e?"audio/mpeg":"application/octet-stream"},{run:function(t,o){var E,r,i,a=(require("path"),t.port),R=t.securedPort,u=t.rootPath,s=t.version,c=t.isNotUsingResourceCache,S={};void 0!==o&&(CHECK_IS_DATA(o)!==!0?E=o:(E=o.requestListener,r=o.error,i=o.notExistsResource)),WEB_SERVER(t,function(t,o,a){var R,_,d,C,T,O=u,v=t.uri,f=t.method,l=t.params,A=t.headers;void 0!==s&&A["if-none-match"]===s?o({statusCode:304}):void 0!==s&&""!==v&&l.version!==s?o({statusCode:302,headers:{Location:"/"+v+"?"+n.stringify(COMBINE_DATA({origin:l,extend:{version:s}}))}}):(d={},void 0!==E&&(R=E(t,o,a,function(t){O=t},function(t){_=t},function(t,e){d[t]=e}),v=t.uri,f=t.method,l=t.params,A=t.headers),R!==!1&&t.isResponsed!==!0&&"GET"===f&&(C=function(e){void 0!==i&&i(e,t,o),t.isResponsed!==!0&&o({statusCode:404})},T=function(e){console.log(CONSOLE_RED("[UPPERCASE.JS-RESOURCE_SERVER] ERROR: "+e)),void 0!==r&&r(e,t,o),t.isResponsed!==!0&&o({statusCode:500})},NEXT([function(t){var e=S[v];void 0!==e?t(e.content,e.contentType):READ_FILE(O+"/"+v,{notExists:function(){READ_FILE(O+(""===v?"":"/"+v)+"/index.html",{notExists:C,error:T,success:function(e){t(e,"text/html")}})},error:T,success:t})},function(){return function(t,n){void 0===n&&(n=void 0!==_?_:e(v)),c!==!0&&void 0===S[v]&&(S[v]={content:t,contentType:n}),o({content:t,contentType:n,version:s})}}])))}),console.log("[UPPERCASE.JS-RESOURCE_SERVER] RUNNING RESOURCE SERVER..."+(void 0===a?"":" (PORT:"+a+")")+(void 0===R?"":" (SECURED PORT:"+R+")"))}}}),global.SOCKET_SERVER=SOCKET_SERVER=METHOD({run:function(t,e){"use strict";var o=require("net"),n=o.createServer(function(t){var o,n,E,r,i={},a="",R=function(t,e){var o=i[t];void 0!==o&&EACH(o,function(o){o(e,function(e){r({methodName:"__CALLBACK_"+t,data:e})})})};t.on("data",function(t){var e,o,n;for(a+=t.toString();-1!==(o=a.indexOf("\n"));)e=a.substring(0,o),n=PARSE_STR(e),void 0!==n&&R(n.methodName,n.data),a=a.substring(o+1)}),t.on("close",function(){o!==!0&&R("__DISCONNECTED"),i=void 0}),t.on("error",function(t){R("__ERROR",t)}),e({ip:t.remoteAddress},n=function(t,e){var o=i[t];void 0===o&&(o=i[t]=[]),o.push(e)},E=function(t,e){var o=i[t];void 0!==o&&(void 0!==e?REMOVE({data:o,value:e}):delete i[t])},r=function(e,o){var r=e.methodName;t.write(STRINGIFY(e)+"\n"),void 0!==o&&n("__CALLBACK_"+r,function(t){o(t),E("__CALLBACK_"+r)})},function(){o=!0,t.end()})});n.listen(t),console.log("[UPPERCASE.JS-SOCKET_SERVER] RUNNING SOCKET SERVER... (PORT:"+t+")")}}),global.WEB_SERVER=WEB_SERVER=METHOD(function(t){"use strict";var e,o=require("http"),n=require("querystring");return t.getEncodingFromContentType=e=function(t){return"text/javascript"===t?"utf-8":"text/css"===t?"utf-8":"text/plain"===t?"binary":"text/html"===t?"utf-8":"image/png"===t?"binary":"image/jpeg"===t?"binary":"image/gif"===t?"binary":"application/x-shockwave-flash"===t?"binary":"audio/mpeg"===t?"binary":"binary"},{run:function(t,E){var r,i,a,R,u,s;CHECK_IS_DATA(t)!==!0?r=t:(r=t.port,i=t.securedPort,a=t.securedKeyFilePath,R=t.securedCertFilePath,u=t.isNotParsingNativeReq),s=function(t,o){var r,i,a=t.headers,R=t.url,s=t.method.toUpperCase(),c=a["X-Forwarded-For"],S=[];void 0===c&&(c=t.connection.remoteAddress),-1!=R.indexOf("?")&&(r=R.substring(R.indexOf("?")+1),R=R.substring(0,R.indexOf("?"))),R=R.substring(1),NEXT([function(e){"GET"===s||u===!0?e():(t.on("data",function(t){void 0===r&&(r=""),r+=t}),t.on("end",function(){e()}))},function(){return function(){E(i={headers:a,uri:R,method:s,params:n.parse(r),ip:c,cookies:PARSE_COOKIE_STR(a.cookie),nativeReq:t},function(t){var n,E,r,a,R,u;i.isResponsed!==!0&&(CHECK_IS_DATA(t)!==!0?a=t:(n=t.statusCode,E=t.headers,r=t.contentType,a=t.content,R=t.encoding,u=t.version),void 0===n&&(n=200),void 0===E&&(E={}),void 0!==r&&(E["Content-Type"]=r,void 0===R&&(R=e(r))),void 0!==u&&(E.ETag=u),o.writeHead(n,E),o.end(a,R),i.isResponsed=!0)},function(t){S.push(t)})}}]),u!==!0&&t.on("close",function(){EACH(S,function(t){t()})})},void 0!==r&&o.createServer(s).listen(r),void 0!==i&&https.createServer({key:fs.readFileSync(a),cert:fs.readFileSync(R)},s).listen(i),console.log("[UPPERCASE.JS-WEB_SERVER] RUNNING WEB SERVER..."+(void 0===r?"":" (PORT:"+r+")")+(void 0===i?"":" (SECURED PORT:"+i+")"))}}}),global.PARSE_COOKIE_STR=PARSE_COOKIE_STR=METHOD({run:function(t){"use strict";var e,o={};return void 0!==t&&(e=t.split(";"),EACH(e,function(t){var e=t.split("=");o[e[0].trim()]=decodeURIComponent(e[1])})),o}}),global.CREATE_COOKIE_STR_ARRAY=CREATE_COOKIE_STR_ARRAY=METHOD({run:function(t){"use strict";var e=[];return EACH(t,function(t,o){e.push(o+"="+encodeURIComponent(t))}),e}});