global.BOOT=function(params){"use strict";var path=require("path"),cluster=require("cluster"),version,UPPERCASE_IO_PATH=__dirname+"/..",rootPath=process.cwd(),browserScriptContentInfos=[],browserScript="",indexPageContent="",boxNamesInBOXFolder=[],loadForNode=function(e){require(e)},addContentToBrowserScript=function(e){browserScript+=e,browserScriptContentInfos.push({type:"content",content:e})},loadForBrowser=function(e,t){browserScript+=READ_FILE({path:e,isSync:!0}).toString()+"\n",t!==!0&&browserScriptContentInfos.push({type:"js",path:e})},loadForClient=function(e){loadForBrowser(e)},loadForCommon=function(e){loadForNode(e),loadForBrowser(e)},reloadBrowserScript=function(){browserScript="",EACH(browserScriptContentInfos,function(e){"content"===e.type?browserScript+=e.content:"js"===e.type&&loadForBrowser(e.path,!0)})},checkIsAllowedFolderName=function(e){return"BOX"!==e&&"node_modules"!==e&&"not_load"!==e&&"deprecated"!==e&&"_"!==e[0]},loadUJS,configuration,initBoxes,clustering,initDatabase,initModelSystem,loadAllScripts,generateIndexPage,run;addContentToBrowserScript("global = window;\n"),loadUJS=function(){loadForNode(UPPERCASE_IO_PATH+"/UPPERCASE.JS-COMMON.js"),loadForNode(UPPERCASE_IO_PATH+"/UPPERCASE.JS-NODE.js"),loadForBrowser(UPPERCASE_IO_PATH+"/UPPERCASE.JS-COMMON.js"),loadForBrowser(UPPERCASE_IO_PATH+"/UPPERCASE.JS-BROWSER.js")},configuration=function(){var _CONFIG,_NODE_CONFIG,_BROWSER_CONFIG,stringifyJSONWithFunction=function(data){return JSON.stringify(data,function(e,t){return"function"==typeof t?"__THIS_IS_FUNCTION_START__"+t.toString()+"__THIS_IS_FUNCTION_END__":t},"	").replace(/("__THIS_IS_FUNCTION_START__(.*)__THIS_IS_FUNCTION_END__")/g,function(match,content){return eval("("+eval('"'+content.substring('"__THIS_IS_FUNCTION_START__'.length,content.length-'__THIS_IS_FUNCTION_END__"'.length)+'"')+")").toString()})};NODE_CONFIG.rootPath=rootPath,void 0!==params&&(_CONFIG=params.CONFIG,_NODE_CONFIG=params.NODE_CONFIG,_BROWSER_CONFIG=params.BROWSER_CONFIG),void 0!==_CONFIG&&(EXTEND({origin:CONFIG,extend:_CONFIG}),addContentToBrowserScript("EXTEND({ origin : CONFIG, extend : "+stringifyJSONWithFunction(_CONFIG)+" });\n")),CONFIG.isDevMode===!0&&cluster.isMaster===!0&&(version="V"+Date.now(),WRITE_FILE({path:rootPath+"/V",content:version,isSync:!0})),READ_FILE({path:rootPath+"/V",isSync:!0},{notExists:function(){console.log(CONSOLE_RED("[UPPERCASE.IO] NOT EXISTS `V` VERSION FILE!")),version="V__NOT_EXISTS"},success:function(e){version=e.toString()}}),CONFIG.version=version,addContentToBrowserScript("CONFIG.version = '"+version+"'\n"),void 0!==_NODE_CONFIG&&EXTEND({origin:NODE_CONFIG,extend:_NODE_CONFIG}),void 0!==_BROWSER_CONFIG&&addContentToBrowserScript("EXTEND({ origin : BROWSER_CONFIG, extend : "+stringifyJSONWithFunction(_BROWSER_CONFIG)+" });\n"),addContentToBrowserScript("BROWSER_CONFIG.fixScriptsFolderPath = '/UPPERCASE.JS-BROWSER-FIX';\n"),addContentToBrowserScript("BROWSER_CONFIG.fixTransportScriptsFolderPath = '/UPPERCASE.IO-TRANSPORT';\n"),VALID.addIgnoreAttr("$inc"),addContentToBrowserScript("VALID.addIgnoreAttr('$inc');\n")},initBoxes=function(){loadForCommon(UPPERCASE_IO_PATH+"/UPPERCASE.IO-BOX/CORE.js"),BOX("UPPERCASE.IO"),addContentToBrowserScript("BOX('UPPERCASE.IO');\n"),FIND_FOLDER_NAMES({path:rootPath,isSync:!0},function(e){EACH(e,function(e){checkIsAllowedFolderName(e)===!0&&(BOX(e),addContentToBrowserScript("BOX('"+e+"');\n"))})}),CHECK_IS_EXISTS_FILE({path:rootPath+"/BOX",isSync:!0})===!0&&FIND_FOLDER_NAMES({path:rootPath+"/BOX",isSync:!0},function(e){EACH(e,function(e){checkIsAllowedFolderName(e)===!0&&(BOX(e),addContentToBrowserScript("BOX('"+e+"');\n"),boxNamesInBOXFolder.push(e))})}),loadForBrowser(UPPERCASE_IO_PATH+"/UPPERCASE.IO-BOX/CLIENT.js"),loadForBrowser(UPPERCASE_IO_PATH+"/UPPERCASE.IO-BOX/BROWSER.js")},clustering=function(e){CPU_CLUSTERING(function(){void 0!==NODE_CONFIG.clusteringServers&&void 0!==NODE_CONFIG.thisServerName&&void 0!==NODE_CONFIG.clusteringPort?SERVER_CLUSTERING({servers:NODE_CONFIG.clusteringServers,thisServerName:NODE_CONFIG.thisServerName,port:NODE_CONFIG.clusteringPort},e):e()})},initDatabase=function(){loadForNode(UPPERCASE_IO_PATH+"/UPPERCASE.IO-DB/NODE.js"),void 0!==NODE_CONFIG.dbName&&CONNECT_TO_DB_SERVER({name:NODE_CONFIG.dbName,host:NODE_CONFIG.dbHost,port:NODE_CONFIG.dbPort,username:NODE_CONFIG.dbUsername,password:NODE_CONFIG.dbPassword})},initModelSystem=function(){loadForNode(UPPERCASE_IO_PATH+"/UPPERCASE.IO-TRANSPORT/NODE.js"),loadForBrowser(UPPERCASE_IO_PATH+"/UPPERCASE.IO-TRANSPORT/BROWSER.js"),loadForNode(UPPERCASE_IO_PATH+"/UPPERCASE.IO-ROOM/NODE.js"),loadForClient(UPPERCASE_IO_PATH+"/UPPERCASE.IO-ROOM/CLIENT.js"),loadForBrowser(UPPERCASE_IO_PATH+"/UPPERCASE.IO-ROOM/BROWSER.js"),loadForCommon(UPPERCASE_IO_PATH+"/UPPERCASE.IO-MODEL/COMMON.js"),loadForNode(UPPERCASE_IO_PATH+"/UPPERCASE.IO-MODEL/NODE.js"),loadForClient(UPPERCASE_IO_PATH+"/UPPERCASE.IO-MODEL/CLIENT.js")},loadAllScripts=function(){var e=function(e,t){var o=function(e){FIND_FILE_NAMES({path:e,isSync:!0},{notExists:function(){},success:function(o){EACH(o,function(o){var n=e+"/"+o,r=path.extname(o).toLowerCase();".js"===r&&t(n)})}}),FIND_FOLDER_NAMES({path:e,isSync:!0},{notExists:function(){},success:function(t){EACH(t,function(t){checkIsAllowedFolderName(t)===!0&&o(e+"/"+t)})}})};FOR_BOX(function(n){var r=CHECK_IS_IN({array:boxNamesInBOXFolder,value:n.boxName})===!0?rootPath+"/BOX":rootPath;o(r+"/"+n.boxName+"/"+e),FIND_FILE_NAMES({path:r+"/"+n.boxName,isSync:!0},{notExists:function(){},success:function(o){EACH(o,function(o){var i=r+"/"+n.boxName+"/"+o,s=path.extname(o).toLowerCase();o===e+s&&".js"===s&&t(i)})}})})};e("COMMON",loadForCommon),e("NODE",loadForNode),e("BROWSER",loadForBrowser),e("CLIENT",loadForClient)},generateIndexPage=function(){indexPageContent+="<!DOCTYPE html>",indexPageContent+="<html>",indexPageContent+="<head>",indexPageContent+='<meta charset="utf-8">',indexPageContent+='<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no'+(CONFIG.isMobileFullScreen===!0?", minimal-ui":"")+'">',indexPageContent+='<meta name="google" value="notranslate">',void 0!==CONFIG.googleSiteVerificationKey&&(indexPageContent+='<meta name="google-site-verification" content="'+CONFIG.googleSiteVerificationKey+'" />'),indexPageContent+='<meta http-equiv="X-UA-Compatible" content="IE=Edge, chrome=1">',void 0!==CONFIG.description&&(indexPageContent+='<meta name="description" content="'+CONFIG.description+'">'),indexPageContent+='<link href="/favicon.ico" rel="shortcut icon">',indexPageContent+="<title>"+CONFIG.title+"</title>",indexPageContent+='<link rel="stylesheet" type="text/css" href="/__CSS?'+CONFIG.version+'" />',indexPageContent+="<style>",indexPageContent+="html, body {",indexPageContent+="background-color : "+CONFIG.baseBackgroundColor+";",indexPageContent+="color : "+CONFIG.baseColor+";",indexPageContent+="}",indexPageContent+="</style>",indexPageContent+="</head>",indexPageContent+="<body>",indexPageContent+="<noscript>",indexPageContent+='<p style="padding:15px;">',indexPageContent+="JavaScript is disabled. Please enable JavaScript in your browser.",indexPageContent+="</p>",indexPageContent+="</noscript>",indexPageContent+='<script type="text/javascript" src="/__SCRIPT?'+CONFIG.version+'"></script>',indexPageContent+="</body>",indexPageContent+="</html>"},run=function(){var e,t,o,n,r,i,s,a,O,E={},C=CALENDAR();void 0!==NODE_CONFIG.uploadServers&&(e=[],n=0,EACH(NODE_CONFIG.uploadServers,function(t){e.push(t)})),void 0!==NODE_CONFIG.socketServers&&(t=[],r=0,EACH(NODE_CONFIG.socketServers,function(e){t.push(e)})),void 0!==NODE_CONFIG.webSocketServers&&(o=[],i=0,EACH(NODE_CONFIG.webSocketServers,function(e){o.push(e)})),INIT_OBJECTS(),FOR_BOX(function(e){void 0!==e.MAIN&&e.MAIN(function(t){E[e.boxName]=t})}),(void 0!==CONFIG.webServerPort||void 0!==CONFIG.sercuredWebServerPort)&&(loadForNode(UPPERCASE_IO_PATH+"/UPPERCASE.IO-UPLOAD/NODE.js"),a=RESOURCE_SERVER({port:CONFIG.webServerPort,securedPort:CONFIG.sercuredWebServerPort,securedKeyFilePath:rootPath+"/"+NODE_CONFIG.securedKeyFilePath,securedCertFilePath:rootPath+"/"+NODE_CONFIG.securedCertFilePath,noParsingParamsURI:"__UPLOAD",rootPath:rootPath,version:version},{requestListener:function(a,C,d,c,P){var S,_,I,N=a.uri,l=(a.method,a.headers),R=a.params,u=function(e){return void 0!==R.callback?R.callback+"('"+e+"')":e};if("__CHECK_ALIVE"===N)return C({content:"",headers:{"Access-Control-Allow-Origin":"*"}}),!1;if("__SCRIPT"===N)return CONFIG.isDevMode===!0?(reloadBrowserScript(),C({contentType:"text/javascript",content:browserScript})):C(l["if-none-match"]===version?{statusCode:304}:R.version!==version?{statusCode:302,headers:{Location:"/__SCRIPT?version="+version}}:{contentType:"text/javascript",content:browserScript,version:version}),!1;if("__CSS"===N)c(UPPERCASE_IO_PATH),a.uri="UPPERCASE.IO-IO/R/BASE_STYLE.css";else{if("__UPLOAD_SERVER_HOST"===N)return void 0===e?C({content:u(R.defaultHost),headers:{"Access-Control-Allow-Origin":"*"}}):(C({content:u(e[n]),headers:{"Access-Control-Allow-Origin":"*"}}),n+=1,n===e.length&&(n=0)),!1;if("__UPLOAD"===N)return UPLOAD_REQUEST({requestInfo:a,uploadPath:rootPath+"/__RF/__TEMP"},{overFileSize:function(){C({statusCode:302,headers:{Location:R.callbackURL+"?maxUploadFileMB="+NODE_CONFIG.maxUploadFileMB}})},success:function(e){var t,o=R.boxName,n=BOX.getBoxes()[void 0===o?CONFIG.defaultBoxName:o];void 0!==n&&(t=n.DB("__UPLOAD_FILE"),NEXT(e,[function(e,n){var r=e.path;delete e.path,e.serverName=NODE_CONFIG.thisServerName,e.downloadCount=0,t.create(e,function(e){MOVE_FILE({from:r,to:rootPath+"/__RF/"+o+"/"+e.id},n)})},function(){return function(){var t=STRINGIFY(e);C(void 0===R.callbackURL?t:{statusCode:302,headers:{Location:R.callbackURL+"?fileDataSetStr="+encodeURIComponent(t)}})}}]))}}),!1;if("__RF/"===N.substring(0,5))return N=N.substring(5),I=N.indexOf("/"),-1!==I&&(S=N.substring(0,I),"UPPERCASE.IO"===S||void 0!==BOX.getBoxes()[S]?N=N.substring(I+1):S=CONFIG.defaultBoxName,_=BOX.getBoxes()[S].DB("__UPLOAD_FILE"),_.get(-1===N.lastIndexOf("/")?N:N.substring(N.lastIndexOf("/")+1),{error:function(){P({isFinal:!0})},notExists:function(){P({isFinal:!0})},success:function(e){e.serverName===NODE_CONFIG.thisServerName?(P({contentType:e.type,headers:{"Content-Disposition":'attachment; filename="'+e.name+'"',"Access-Control-Allow-Origin":"*"},isFinal:!0}),_.update({id:e.id,$inc:{downloadCount:1}})):C({statusCode:302,headers:{Location:"http://"+NODE_CONFIG.uploadServers[e.serverName]+":"+CONFIG.webServerPort+"/__RF/"+S+"/"+N}})}})),!1;if("__UPLOAD_CALLBACK"===N)c(UPPERCASE_IO_PATH+"/UPPERCASE.IO-UPLOAD/R"),a.uri="UPLOAD_CALLBACK.html";else{if("__SOCKET_SERVER_HOST"===N)return void 0===t?C({content:u(R.defaultHost)}):(C({content:u(t[r])}),r+=1,r===t.length&&(r=0)),!1;if("__WEB_SOCKET_SERVER_HOST"===N)return void 0===o?C({content:u(R.defaultHost),headers:{"Access-Control-Allow-Origin":"*"}}):(C({content:u(o[i]),headers:{"Access-Control-Allow-Origin":"*"}}),i+=1,i===o.length&&(i=0)),!1;if("__WEB_SOCKET_FIX"===N)return O(a,{response:C,onDisconnected:d}),!1;if(I=N.indexOf("/"),-1===I?S=CONFIG.defaultBoxName:(S=N.substring(0,I),void 0!==BOX.getBoxes()[S]||"UPPERCASE.IO-TRANSPORT"===S||"UPPERCASE.JS-BROWSER-FIX"===S?N=N.substring(I+1):S=CONFIG.defaultBoxName),"UPPERCASE.IO-TRANSPORT"===S)c(UPPERCASE_IO_PATH+"/UPPERCASE.IO-TRANSPORT/R"),a.uri=N;else if("UPPERCASE.JS-BROWSER-FIX"===S)c(UPPERCASE_IO_PATH+"/UPPERCASE.JS-BROWSER-FIX"),a.uri=N;else{if(void 0!==E[S]&&(s=E[S](a,C,d,c,P)),s===!1)return s;a.uri=CHECK_IS_IN({array:boxNamesInBOXFolder,value:S})===!0?"BOX/"+S+("R/"===N.substring(0,2)?"/":"/R")+(""===N?"":"/"+N):S+("R/"===N.substring(0,2)?"/":"/R")+(""===N?"":"/"+N)}}}},notExistsResource:function(e,t,o){(t.uri===CONFIG.defaultBoxName+"/R"||t.uri==="BOX/"+CONFIG.defaultBoxName+"/R")&&o({contentType:"text/html",content:indexPageContent})}}),O=LAUNCH_ROOM_SERVER({socketServerPort:CONFIG.socketServerPort,webServer:a,isCreateWebSocketFixRequestManager:!0}).getWebSocketFixRequest()),console.log("[UPPERCASE.IO] <"+C.getYear()+"-"+C.getMonth()+"-"+C.getDate()+" "+C.getHour()+":"+C.getMinute()+":"+C.getSecond()+"> `"+CONFIG.title+"` WORKER #"+CPU_CLUSTERING.getWorkerId()+" BOOTed!"+(void 0===CONFIG.webServerPort?"":" => http://localhost:"+CONFIG.webServerPort)+(void 0===CONFIG.securedWebServerPort?"":" => https://localhost:"+CONFIG.securedWebServerPort))},loadUJS(),configuration(),initBoxes(),loadForNode(UPPERCASE_IO_PATH+"/UPPERCASE.IO-UTIL/NODE.js"),loadForCommon(UPPERCASE_IO_PATH+"/UPPERCASE.IO-IO/COMMON.js"),loadForClient(UPPERCASE_IO_PATH+"/UPPERCASE.IO-IO/CLIENT.js"),loadForClient(UPPERCASE_IO_PATH+"/UPPERCASE.IO-IO/BROWSER.js"),loadForClient(UPPERCASE_IO_PATH+"/UPPERCASE.IO-IO/BROWSER_INIT.js"),loadForNode(UPPERCASE_IO_PATH+"/UPPERCASE.IO-IO/NODE.js"),clustering(function(){initDatabase(),initModelSystem(),loadAllScripts(),CONFIG.isDevMode!==!0&&(browserScript=MINIFY_JS(browserScript)),generateIndexPage(),run()})};