FOR_BOX(function(o){"use strict";o.MODEL=CLASS({init:function(e,t,n){var i,d,r,a,c,v,E,s,u,O,A,l,f,R,m,N,C,D,g,M,x,I,P,h,S,T,H,U,L,b,_,p=n.name,V=n.config,k=o.ROOM(p),K={},y={},X=[],w=[],W={};t.getName=f=function(){return p},void 0!==V&&(i=V.create,d=V.get,r=V.update,a=V.remove,c=V.find,v=V.count,E=V.checkIsExists,void 0!==i&&(s=i.valid,O=i.initData),void 0!==r&&(u=r.valid)),e.getCreateValid=R=function(){return s},e.getUpdateValid=m=function(){return u},e.initData=N=function(o){return void 0!==O&&O(o),o},t.getRoom=C=function(){return k},i!==!1&&(t.create=D=function(e,t){var n,i,d,r,a;void 0!==N&&N(e),void 0!==t&&(CHECK_IS_DATA(t)!==!0?n=t:(n=t.success,i=t.notValid,d=t.notAuthed,r=t.error)),void 0!==s&&(a=s.check(e)),void 0!==a&&a.checkHasError()===!0?void 0!==i?i(a.getErrors()):console.log("[UPPERCASE.IO-MODEL] `"+o.boxName+"."+p+".create` NOT VALID!: ",a.getErrors()):k.send({methodName:"create",data:e},function(e){var t,a,c,v;void 0!==e?(t=e.errorMsg,a=e.validErrors,c=e.isNotAuthed,v=e.savedData,void 0!==t?void 0!==r?r(t):console.log("[UPPERCASE.IO-MODEL] `"+o.boxName+"."+p+".create` ERROR: "+t):void 0!==a?void 0!==i?i(a):console.log("[UPPERCASE.IO-MODEL] `"+o.boxName+"."+p+".create` NOT VALID!: ",a):c===!0?void 0!==d?d():console.log("[UPPERCASE.IO-MODEL] `"+o.boxName+"."+p+".create` NOT AUTHED!"):void 0!==n&&n(v)):n()})}),d!==!1&&(t.get=g=function(e,t){var n,i,d,r;CHECK_IS_DATA(t)!==!0?n=t:(n=t.success,i=t.notExists,d=t.notAuthed,r=t.error),k.send({methodName:"get",data:e},function(e){var t,a,c;void 0!==e&&(t=e.errorMsg,a=e.isNotAuthed,c=e.savedData),void 0!==t?void 0!==r?r(t):console.log("[UPPERCASE.IO-MODEL] `"+o.boxName+"."+p+".get` ERROR: "+t):a===!0?void 0!==d?d():console.log("[UPPERCASE.IO-MODEL] `"+o.boxName+"."+p+".get` NOT AUTHED!"):void 0===c?void 0!==i?i():console.log("[UPPERCASE.IO-MODEL] `"+o.boxName+"."+p+".get` NOT EXISTS!"):void 0!==n&&n(c)})},t.getWatching=M=function(e,t){var n,i,d,r;CHECK_IS_DATA(t)!==!0?n=t:(n=t.success,i=t.notExists,d=t.notAuthed,r=t.error),g(e,{success:function(e){var t,i;void 0!==n&&(X.push(t=o.ROOM(p+"/"+e.id)),n(e,function(o){t.on("update",o)},function(o){t.on("remove",function(e){o(e),i()})},i=function(){REMOVE({array:X,value:t}),t.exit()}))},notExists:i,notAuthedHandler:d,errorHandler:r})}),r!==!1&&(t.update=x=function(e,t){var n,i,d,r,a,c;void 0!==t&&(CHECK_IS_DATA(t)!==!0?n=t:(n=t.success,i=t.notValid,d=t.notExists,r=t.notAuthed,a=t.error)),void 0!==u&&(c=u.checkExceptUndefined(e)),void 0!==u&&c.checkHasError()===!0?void 0!==i?i(c.getErrors()):console.log("[UPPERCASE.IO-MODEL] `"+o.boxName+"."+p+".update` NOT VALID!: ",c.getErrors()):k.send({methodName:"update",data:e},function(e){var t,c,v,E;void 0!==e&&(t=e.errorMsg,c=e.validErrors,v=e.isNotAuthed,E=e.savedData),void 0!==t?void 0!==a?a(t):console.log("[UPPERCASE.IO-MODEL] `"+o.boxName+"."+p+".update` ERROR: "+t):void 0!==c?void 0!==i?i(c):console.log("[UPPERCASE.IO-MODEL] `"+o.boxName+"."+p+".update` NOT VALID!: ",c):v===!0?void 0!==r?r():console.log("[UPPERCASE.IO-MODEL] `"+o.boxName+"."+p+".update` NOT AUTHED!"):void 0===E?void 0!==d?d():console.log("[UPPERCASE.IO-MODEL] `"+o.boxName+"."+p+".update` NOT EXISTS!"):void 0!==n&&n(E)})}),a!==!1&&(t.remove=I=function(e,t){var n,i,d,r;void 0!==t&&(CHECK_IS_DATA(t)!==!0?n=t:(n=t.success,i=t.notExists,d=t.notAuthed,r=t.error)),k.send({methodName:"remove",data:e},function(e){var t,a,c;void 0!==e&&(t=e.errorMsg,a=e.isNotAuthed,c=e.savedData),void 0!==t?void 0!==r?r(t):console.log("[UPPERCASE.IO-MODEL] `"+o.boxName+"."+p+".remove` ERROR: "+t):a===!0?void 0!==d?d():console.log("[UPPERCASE.IO-MODEL] `"+o.boxName+"."+p+".remove` NOT AUTHED!"):void 0===c?void 0!==i?i():console.log("[UPPERCASE.IO-MODEL] `"+o.boxName+"."+p+".remove` NOT EXISTS!"):void 0!==n&&n(c)})}),c!==!1&&(t.find=P=function(e,t){var n,i,d;void 0===t&&(t=e,e=void 0),void 0!==t&&(CHECK_IS_DATA(t)!==!0?n=t:(n=t.success,i=t.notAuthed,d=t.error)),k.send({methodName:"find",data:e},function(e){var t=e.errorMsg,r=e.isNotAuthed,a=e.savedDataSet;void 0!==t?void 0!==d?d(t):console.log("[UPPERCASE.IO-MODEL] `"+o.boxName+"."+p+".find` ERROR: "+t):r===!0?void 0!==i?i():console.log("[UPPERCASE.IO-MODEL] `"+o.boxName+"."+p+".find` NOT AUTHED!"):void 0!==n&&n(a)})},t.findWatching=h=function(e,t){var n,i,d;void 0===t&&(t=e,e=void 0),void 0!==t&&(CHECK_IS_DATA(t)!==!0?n=t:(n=t.success,i=t.notAuthed,d=t.error)),P(e,{success:function(e){var t,i={};void 0!==n&&(EACH(e,function(e){var t=e.id;X.push(i[t]=o.ROOM(p+"/"+t))}),n(e,function(o,e){i[o].on("update",e)},function(o,e){i[o].on("remove",function(n){e(n),t(o)})},t=function(o){void 0!==i[o]&&(REMOVE({array:X,value:i[o]}),i[o].exit(),delete i[o])}))},notAuthedHandler:i,errorHandler:d})}),v!==!1&&(t.count=S=function(e,t){var n,i,d;void 0===t&&(t=e,e=void 0),void 0!==t&&(CHECK_IS_DATA(t)!==!0?n=t:(n=t.success,i=t.notAuthed,d=t.error)),k.send({methodName:"count",data:e},function(e){var t=e.errorMsg,r=e.isNotAuthed,a=e.count;void 0!==t?void 0!==d?d(t):console.log("[UPPERCASE.IO-MODEL] `"+o.boxName+"."+p+".count` ERROR: "+t):r===!0?void 0!==i?i():console.log("[UPPERCASE.IO-MODEL] `"+o.boxName+"."+p+".count` NOT AUTHED!"):void 0!==n&&n(a)})}),E!==!1&&(t.checkIsExists=T=function(e,t){var n,i,d;void 0===t&&(t=e,e=void 0),void 0!==t&&(CHECK_IS_DATA(t)!==!0?n=t:(n=t.success,i=t.notAuthed,d=t.error)),k.send({methodName:"checkIsExists",data:e},function(e){var t=e.errorMsg,r=e.isNotAuthed,a=e.isExists;void 0!==t?void 0!==d?d(t):console.log("[UPPERCASE.IO-MODEL] `"+o.boxName+"."+p+".checkIsExists` ERROR: "+t):r===!0?void 0!==i?i():console.log("[UPPERCASE.IO-MODEL] `"+o.boxName+"."+p+".checkIsExists` NOT AUTHED!"):void 0!==n&&n(a)})}),t.onNew=H=function(e,t){var n=function(o){o.id;t(o)};void 0===t?(t=e,void 0===A&&(A=o.ROOM(p+"/create")),A.on("create",n)):EACH(e,function(e,t){var i=K[t+"/"+e];void 0===i&&(i=K[t+"/"+e]=o.ROOM(p+"/"+t+"/"+e+"/create")),i.on("create",n)})},t.onNewWatching=U=function(e,t){var n=function(e,n){var i,d,r=e.id;X.push(i=o.ROOM(p+"/"+r)),n.push(i),t(e,function(o){i.on("update",o)},function(o){i.on("remove",function(e){o(e),d()})},d=function(){i.exit(),REMOVE({array:X,value:i})})};void 0===t?(t=e,void 0===A&&(A=o.ROOM(p+"/create")),A.on("create",function(o){n(o,w)})):EACH(e,function(e,t){var i=K[t+"/"+e],d=W[t+"/"+e];void 0===i&&(i=K[t+"/"+e]=o.ROOM(p+"/"+t+"/"+e+"/create")),void 0===d&&(d=W[t+"/"+e]=[]),i.on("create",function(o){n(o,d)})})},t.closeOnNew=L=function(o){void 0===o?(void 0!==A&&(A.exit(),A=void 0),EACH(w,function(o){o.exit(),REMOVE({array:X,value:o})}),w=[]):EACH(o,function(o,e){void 0!==K[e+"/"+o]&&(K[e+"/"+o].exit(),delete K[e+"/"+o]),EACH(W[e+"/"+o],function(o){o.exit(),REMOVE({array:X,value:o})}),delete W[e+"/"+o]})},t.onRemove=b=function(e,t){var n=function(o){o.id;t(o)};void 0===t?(t=e,void 0===l&&(l=o.ROOM(p+"/remove")),l.on("remove",n)):EACH(e,function(e,t){var i=y[t+"/"+e];void 0===i&&(i=y[t+"/"+e]=o.ROOM(p+"/"+t+"/"+e+"/remove")),i.on("remove",n)})},t.closeOnRemove=_=function(o){void 0===o?void 0!==l&&(l.exit(),l=void 0):EACH(o,function(o,e){void 0!==y[e+"/"+o]&&(y[e+"/"+o].exit(),delete y[e+"/"+o])})}}})});