FOR_BOX(function(o){"use strict";OVERRIDE(o.MODEL,function(){o.MODEL=CLASS({init:function(e,t,i){var r,n,a,c,d,u,v,s,f,E,C,A,O,N,m,S,l,D,I,_,g,h,H,L,T,M,p,x,R,K,b,P,k,B,U,V,X,W=i.name,Y=i.config,F=[],j=[],q=[],w=[],y=[],z=[],G=[],J=[],Q=[],Z=[],$=o.DB(W),oe=function(e,t){console.log(CONSOLE_RED("[UPPERCASE.IO-MODEL] `"+o.boxName+"."+W+"."+e+"` ERROR: "+t))};t.getName=D=function(){return W},void 0!==Y&&(r=Y.create,n=Y.get,a=Y.update,c=Y.remove,d=Y.find,u=Y.count,v=Y.checkIsExists,void 0!==r&&(s=r.valid,E=r.role,l=r.initData),void 0!==n&&(C=n.role),void 0!==a&&(f=a.valid,A=a.role),void 0!==c&&(O=c.role),void 0!==d&&(N=d.role),void 0!==u&&(m=u.role),void 0!==v&&(S=v.role)),e.getCreateValid=I=function(){return s},e.getUpdateValid=_=function(){return f},e.initData=g=function(o){return void 0!==l&&l(o),o},t.getDB=h=function(){return $},e.on=H=function(o,e){"create"===o?(void 0!==e.before&&F.push(e.before),void 0!==e.after&&j.push(e.after)):"get"===o?q.push(e):"update"===o?(void 0!==e.before&&w.push(e.before),void 0!==e.after&&y.push(e.after)):"remove"===o?(void 0!==e.before&&z.push(e.before),void 0!==e.after&&G.push(e.after)):"find"===o?J.push(e):"count"===o?Q.push(e):"checkIsExists"===o&&Z.push(e)},L=function(e,t,i){var r,n;g(e),REMOVE_TO_DELETE(e),void 0!==s&&(r=s.check(e)),void 0!==r&&r.checkHasError()===!0?t({validErrors:r.getErrors()}):NEXT([function(o){EACH(F,function(r){var a=r(e,t,o,i);n!==!0&&a===!1&&(n=!0)}),n!==!0&&o()},function(){return function(){$.create(e,{error:function(o){oe("create",o),t({errorMsg:o})},success:function(e){EACH(j,function(o){o(e,i)}),o.BROADCAST({roomName:W+"/create",methodName:"create",data:e}),EACH(e,function(t,i){o.BROADCAST({roomName:W+"/"+i+"/"+t+"/create",methodName:"create",data:e})}),t({savedData:e})}})}}])},T=function(o,e,t){var i;$.get(o,{error:function(o){oe("get",o),e({errorMsg:o})},notExists:function(){e()},success:function(o){EACH(q,function(r){var n=r(o,e,t);i!==!0&&n===!1&&(i=!0)}),i!==!0&&e({savedData:o})}})},M=function(e,t,i){var r,n;void 0!==f&&(r=f.checkExceptUndefined(e)),void 0!==r&&r.checkHasError()===!0?t({validErrors:r.getErrors()}):NEXT([function(o){EACH(w,function(r){var a=r(e,t,o,i);n!==!0&&a===!1&&(n=!0)}),n!==!0&&o()},function(){return function(){$.update(e,{error:function(o){oe("update",o),t({errorMsg:o})},notExists:function(){t()},success:function(e){void 0!==e&&(EACH(y,function(o){o(e,i)}),o.BROADCAST({roomName:W+"/"+e.id,methodName:"update",data:e}),EACH(e,function(t,i){o.BROADCAST({roomName:W+"/"+i+"/"+t+"/update",methodName:"update",data:e})})),t({savedData:e})}})}}])},p=function(e,t,i){var r;NEXT([function(o){EACH(z,function(n){var a=n(e,t,o,i);r!==!0&&a===!1&&(r=!0)}),r!==!0&&o()},function(){return function(){$.remove(e,{error:function(o){oe("remove",o),t({errorMsg:o})},notExists:function(){t()},success:function(e){void 0!==e&&(EACH(G,function(o){o(e,i)}),o.BROADCAST({roomName:W+"/"+e.id,methodName:"remove",data:e}),EACH(e,function(t,i){o.BROADCAST({roomName:W+"/"+i+"/"+t+"/remove",methodName:"remove",data:e})})),t({savedData:e})}})}}])},x=function(o,e,t){var i;$.find(o,{error:function(o){oe("find",o),e({errorMsg:o})},success:function(o){EACH(J,function(r){var n=r(o,e,t);i!==!0&&n===!1&&(i=!0)}),i!==!0&&e({savedDataSet:o})}})},R=function(o,e,t){var i;$.count(o,{error:function(o){oe("count",o),e({errorMsg:o})},success:function(o){EACH(Q,function(r){var n=r(o,e,t);i!==!0&&n===!1&&(i=!0)}),i!==!0&&e({count:o})}})},K=function(o,e,t){var i;$.checkIsExists(o,{error:function(o){oe("checkIsExists",o),e({errorMsg:o})},success:function(o){EACH(Z,function(){var r=Z(o,e,t);i!==!0&&r===!1&&(i=!0)}),i!==!0&&e({isExists:o})}})},r!==!1&&(t.create=b=function(e,t){var i,r,n;void 0!==t&&(CHECK_IS_DATA(t)!==!0?i=t:(i=t.success,r=t.notValid,n=t.error)),L(e,function(e){var t,a,c;void 0!==e?(t=e.errorMsg,a=e.validErrors,c=e.savedData,void 0!==t?void 0!==n&&n(t):void 0!==a?void 0!==r?r(a):console.log(CONSOLE_YELLOW("[UPPERCASE.IO-MODEL] `"+o.boxName+"."+W+".create` NOT VALID."),a):void 0!==i&&i(c)):void 0!==i&&i()})}),n!==!1&&(t.get=P=function(e,t){var i,r,n;void 0===t&&(t=e,e=void 0),CHECK_IS_DATA(t)!==!0?i=t:(i=t.success,r=t.notExists,n=t.error),T(e,function(t){var a,c;void 0!==t&&(a=t.errorMsg,c=t.savedData),void 0!==a?void 0!==n&&n(a):void 0===c?void 0!==r?r():console.log(CONSOLE_YELLOW("[UPPERCASE.IO-MODEL] `"+o.boxName+"."+W+".get` NOT EXISTS."),e):i(c)})}),a!==!1&&(t.update=k=function(e,t){var i,r,n,a;void 0!==t&&(CHECK_IS_DATA(t)!==!0?i=t:(i=t.success,r=t.notExists,n=t.notValid,a=t.error)),M(e,function(t){var c,d,u;void 0!==t&&(c=t.errorMsg,d=t.validErrors,u=t.savedData),void 0!==c?void 0!==a&&a(c):void 0!==d?void 0!==n?n(d):console.log(CONSOLE_YELLOW("[UPPERCASE.IO-MODEL] `"+o.boxName+"."+W+".update` NOT VALID."),d):void 0===u?void 0!==r?r():console.log(CONSOLE_YELLOW("[UPPERCASE.IO-MODEL] `"+o.boxName+"."+W+".update` NOT EXISTS."),e):void 0!==i&&i(u)})}),c!==!1&&(t.remove=B=function(e,t){var i,r,n;void 0!==t&&(CHECK_IS_DATA(t)!==!0?i=t:(i=t.success,r=t.notExists,n=t.error)),p(e,function(t){var a,c;void 0!==t&&(a=t.errorMsg,c=t.savedData),void 0!==a?void 0!==n&&n(a):void 0===c?void 0!==r?r():console.log(CONSOLE_YELLOW("[UPPERCASE.IO-MODEL] `"+o.boxName+"."+W+".remove` NOT EXISTS."),e):void 0!==i&&i(c)})}),d!==!1&&(t.find=U=function(o,e){var t,i;void 0===e&&(e=o,o=void 0),void 0!==e&&(CHECK_IS_DATA(e)!==!0?t=e:(t=e.success,i=e.error)),x(o,function(o){var e=o.errorMsg,r=o.savedDataSet;void 0!==e?void 0!==i&&i(e):t(r)})}),u!==!1&&(t.count=V=function(o,e){var t,i;void 0===e&&(e=o,o=void 0),void 0!==e&&(CHECK_IS_DATA(e)!==!0?t=e:(t=e.success,i=e.error)),R(o,function(o){var e=o.errorMsg,r=o.count;void 0!==e?void 0!==i&&i(e):t(r)})}),v!==!1&&(t.checkIsExists=X=function(o,e){var t,i;void 0===e&&(e=o,o=void 0),void 0!==e&&(CHECK_IS_DATA(e)!==!0?t=e:(t=e.success,i=e.error)),K(o,function(o){var e=o.errorMsg,r=o.isExists;void 0!==e?void 0!==i&&i(e):t(r)})}),o.ROOM(W,function(o,e){var t=o.roles;void 0===t&&(t=o.roles=[]),r!==!1&&e("create",function(e,i){void 0===E||CHECK_IS_IN({data:t,value:E})===!0?L(e,i,o):i({isNotAuthed:!0})}),n!==!1&&e("get",function(e,i){void 0===C||CHECK_IS_IN({data:t,value:C})===!0?T(e,i,o):i({isNotAuthed:!0})}),a!==!1&&e("update",function(e,i){void 0===A||CHECK_IS_IN({data:t,value:A})===!0?M(e,i,o):i({isNotAuthed:!0})}),c!==!1&&e("remove",function(e,i){void 0===O||CHECK_IS_IN({data:t,value:O})===!0?p(e,i,o):i({isNotAuthed:!0})}),d!==!1&&e("find",function(e,i){void 0===N||CHECK_IS_IN({data:t,value:N})===!0?(void 0!==e&&delete e.isFindAll,x(e,i,o)):i({isNotAuthed:!0})}),u!==!1&&e("count",function(e,i){void 0===m||CHECK_IS_IN({data:t,value:m})===!0?R(e,i,o):i({isNotAuthed:!0})}),v!==!1&&e("checkIsExists",function(e,i){void 0===S||CHECK_IS_IN({data:t,value:S})===!0?K(e,i,o):i({isNotAuthed:!0})})})}})})});