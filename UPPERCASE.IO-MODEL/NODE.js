FOR_BOX(function(o){"use strict";OVERRIDE(o.MODEL,function(){o.MODEL=CLASS({init:function(t,e,i){var r,n,a,c,d,s,u,v,f,E,C,A,l,N,O,m,S,I,D,_,g,h,H,L,T,R,p,M,x,K,b,P,k,B,U,V,X,W=i.name,Y=i.config,F=[],G=[],j=[],q=[],w=[],y=[],z=[],J=[],Q=[],Z=[],$=o.DB(W),ot=function(t,e){console.log(CONSOLE_RED("[UPPERCASE.IO-MODEL] `"+o.boxName+"."+W+"."+t+"` ERROR: "+e))};e.getName=I=function(){return W},void 0!==Y&&(r=Y.create,n=Y.get,a=Y.update,c=Y.remove,d=Y.find,s=Y.count,u=Y.checkIsExists,void 0!==r&&(v=r.valid,E=r.role,S=r.initData),void 0!==n&&(C=n.role),void 0!==a&&(f=a.valid,A=a.role),void 0!==c&&(l=c.role),void 0!==d&&(N=d.role),void 0!==s&&(O=s.role),void 0!==u&&(m=u.role)),t.getCreateValid=D=function(){return v},t.getUpdateValid=_=function(){return f},t.initData=g=function(o){return void 0!==S&&S(o),o},e.getDB=h=function(){return $},t.on=H=function(o,t){"create"===o?(void 0!==t.before&&F.push(t.before),void 0!==t.after&&G.push(t.after)):"get"===o?j.push(t):"update"===o?(void 0!==t.before&&q.push(t.before),void 0!==t.after&&w.push(t.after)):"remove"===o?(void 0!==t.before&&y.push(t.before),void 0!==t.after&&z.push(t.after)):"find"===o?J.push(t):"count"===o?Q.push(t):"checkIsExists"===o&&Z.push(t)},L=function(t,e,i){var r,n;g(t),void 0!==v&&(r=v.check(t)),void 0!==r&&r.checkHasError()===!0?e({validErrors:r.getErrors()}):NEXT([function(o){EACH(F,function(r){var a=r(t,e,o,i);n!==!0&&a===!1&&(n=!0)}),n!==!0&&o()},function(){return function(){$.create(t,{error:function(o){ot("create",o),e({errorMsg:o})},success:function(t){EACH(G,function(o){o(t,i)}),o.BROADCAST({roomName:W+"/create",methodName:"create",data:t}),EACH(t,function(e,i){o.BROADCAST({roomName:W+"/"+i+"/"+e+"/create",methodName:"create",data:t})}),e({savedData:t})}})}}])},T=function(o,t,e){var i,r,n,a,c;CHECK_IS_DATA(o)!==!0?i=o:(i=o.id,r=o.filter,n=o.sort,a=o.isRandom),$.get({id:i,filter:r,sort:n,isRandom:a},{error:function(o){ot("get",o),t({errorMsg:o})},notExists:function(){t()},success:function(o){EACH(j,function(i){var r=i(o,t,e);c!==!0&&r===!1&&(c=!0)}),c!==!0&&t({savedData:o})}})},R=function(t,e,i){var r,n;void 0!==f&&(r=f.checkExceptUndefined(t)),void 0!==r&&r.checkHasError()===!0?e({validErrors:r.getErrors()}):NEXT([function(o){EACH(q,function(r){var a=r(t,e,o,i);n!==!0&&a===!1&&(n=!0)}),n!==!0&&o()},function(){return function(){$.update(t,{error:function(o){ot("update",o),e({errorMsg:o})},notExists:function(){e()},success:function(t){void 0!==t&&(EACH(w,function(o){o(t,i)}),o.BROADCAST({roomName:W+"/"+t.id,methodName:"update",data:t}),EACH(t,function(e,i){o.BROADCAST({roomName:W+"/"+i+"/"+e+"/update",methodName:"update",data:t})})),e({savedData:t})}})}}])},p=function(t,e,i){var r;NEXT([function(o){EACH(y,function(n){var a=n(t,e,o,i);r!==!0&&a===!1&&(r=!0)}),r!==!0&&o()},function(){return function(){$.remove(t,{error:function(o){ot("remove",o),e({errorMsg:o})},notExists:function(){e()},success:function(t){void 0!==t&&(EACH(z,function(o){o(t,i)}),o.BROADCAST({roomName:W+"/"+t.id,methodName:"remove",data:t}),EACH(t,function(e,i){o.BROADCAST({roomName:W+"/"+i+"/"+e+"/remove",methodName:"remove",data:t})})),e({savedData:t})}})}}])},M=function(o,t,e){var i,r,n,a,c,d;void 0!==o&&(i=o.filter,r=o.sort,n=INTEGER(o.start),a=INTEGER(o.count),c=o.isFindAll),$.find({filter:i,sort:r,start:n,count:a,isFindAll:c},{error:function(o){ot("find",o),t({errorMsg:o})},success:function(o){EACH(J,function(i){var r=i(o,t,e);d!==!0&&r===!1&&(d=!0)}),d!==!0&&t({savedDataSet:o})}})},x=function(o,t,e){var i,r;void 0!==o&&(i=o.filter),$.count({filter:i},{error:function(o){ot("count",o),t({errorMsg:o})},success:function(o){EACH(Q,function(i){var n=i(o,t,e);r!==!0&&n===!1&&(r=!0)}),r!==!0&&t({count:o})}})},K=function(o,t,e){var i,r;void 0!==o&&(i=o.filter),$.checkIsExists({filter:i},{error:function(o){ot("checkIsExists",o),t({errorMsg:o})},success:function(o){EACH(Z,function(){var i=Z(o,t,e);r!==!0&&i===!1&&(r=!0)}),r!==!0&&t({isExists:o})}})},r!==!1&&(e.create=b=function(t,e){var i,r,n;void 0!==e&&(CHECK_IS_DATA(e)!==!0?i=e:(i=e.success,r=e.notValid,n=e.error)),L(t,function(t){var e,a,c;void 0!==t?(e=t.errorMsg,a=t.validErrors,c=t.savedData,void 0!==e?void 0!==n&&n(e):void 0!==a?void 0!==r?r(a):console.log(CONSOLE_YELLOW("[UPPERCASE.IO-MODEL] `"+o.boxName+"."+W+".create` NOT VALID."),a):void 0!==i&&i(c)):void 0!==i&&i()})}),n!==!1&&(e.get=P=function(t,e){var i,r,n;CHECK_IS_DATA(e)!==!0?i=e:(i=e.success,r=e.notExists,n=e.error),T(t,function(e){var a,c;void 0!==e&&(a=e.errorMsg,c=e.savedData),void 0!==a?void 0!==n&&n(a):void 0===c?void 0!==r?r():console.log(CONSOLE_YELLOW("[UPPERCASE.IO-MODEL] `"+o.boxName+"."+W+".get` NOT EXISTS."),t):i(c)})}),a!==!1&&(e.update=k=function(t,e){var i,r,n,a;void 0!==e&&(CHECK_IS_DATA(e)!==!0?i=e:(i=e.success,r=e.notExists,n=e.notValid,a=e.error)),R(t,function(e){var c,d,s;void 0!==e&&(c=e.errorMsg,d=e.validErrors,s=e.savedData),void 0!==c?void 0!==a&&a(c):void 0!==d?void 0!==n?n(d):console.log(CONSOLE_YELLOW("[UPPERCASE.IO-MODEL] `"+o.boxName+"."+W+".update` NOT VALID."),d):void 0===s?void 0!==r?r():console.log(CONSOLE_YELLOW("[UPPERCASE.IO-MODEL] `"+o.boxName+"."+W+".update` NOT EXISTS."),t):void 0!==i&&i(s)})}),c!==!1&&(e.remove=B=function(t,e){var i,r,n;void 0!==e&&(CHECK_IS_DATA(e)!==!0?i=e:(i=e.success,r=e.notExists,n=e.error)),p(t,function(e){var a,c;void 0!==e&&(a=e.errorMsg,c=e.savedData),void 0!==a?void 0!==n&&n(a):void 0===c?void 0!==r?r():console.log(CONSOLE_YELLOW("[UPPERCASE.IO-MODEL] `"+o.boxName+"."+W+".remove` NOT EXISTS."),t):void 0!==i&&i(c)})}),d!==!1&&(e.find=U=function(o,t){var e,i;void 0===t&&(t=o,o=void 0),void 0!==t&&(CHECK_IS_DATA(t)!==!0?e=t:(e=t.success,i=t.error)),M(o,function(o){var t=o.errorMsg,r=o.savedDataSet;void 0!==t?void 0!==i&&i(t):e(r)})}),s!==!1&&(e.count=V=function(o,t){var e,i;void 0===t&&(t=o,o=void 0),void 0!==t&&(CHECK_IS_DATA(t)!==!0?e=t:(e=t.success,i=t.error)),x(o,function(o){var t=o.errorMsg,r=o.count;void 0!==t?void 0!==i&&i(t):e(r)})}),u!==!1&&(e.checkIsExists=X=function(o,t){var e,i;void 0===t&&(t=o,o=void 0),void 0!==t&&(CHECK_IS_DATA(t)!==!0?e=t:(e=t.success,i=t.error)),K(o,function(o){var t=o.errorMsg,r=o.isExists;void 0!==t?void 0!==i&&i(t):e(r)})}),o.ROOM(W,function(o,t){var e=o.roles;void 0===e&&(e=o.roles=[]),r!==!1&&t("create",function(t,i){void 0===E||CHECK_IS_IN({data:e,value:E})===!0?L(t,i,o):i({isNotAuthed:!0})}),n!==!1&&t("get",function(t,i){void 0===C||CHECK_IS_IN({data:e,value:C})===!0?T(t,i,o):i({isNotAuthed:!0})}),a!==!1&&t("update",function(t,i){void 0===A||CHECK_IS_IN({data:e,value:A})===!0?R(t,i,o):i({isNotAuthed:!0})}),c!==!1&&t("remove",function(t,i){void 0===l||CHECK_IS_IN({data:e,value:l})===!0?p(t,i,o):i({isNotAuthed:!0})}),d!==!1&&t("find",function(t,i){void 0===N||CHECK_IS_IN({data:e,value:N})===!0?(void 0!==t&&delete t.isFindAll,M(t,i,o)):i({isNotAuthed:!0})}),s!==!1&&t("count",function(t,i){void 0===O||CHECK_IS_IN({data:e,value:O})===!0?x(t,i,o):i({isNotAuthed:!0})}),u!==!1&&t("checkIsExists",function(t,i){void 0===m||CHECK_IS_IN({data:e,value:m})===!0?K(t,i,o):i({isNotAuthed:!0})})})}})})});