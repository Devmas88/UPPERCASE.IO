FOR_BOX(function(o){"use strict";OVERRIDE(o.MODEL,function(){o.MODEL=CLASS({init:function(e,i,t){var r,n,a,s,c,d,u,v,E,f,O,l,C,A,N,S,R,D,m,I,_,g,L,h,H,M,x,T,P,p,b,K,U,k,B,V,X,W=t.name,Y=t.config,F=[],G=[],j=[],q=[],w=[],y=[],z=[],J=[],Q=[],Z=[],$=o.DB(W);i.getName=D=function(){return W},void 0!==Y&&(r=Y.create,n=Y.get,a=Y.update,s=Y.remove,c=Y.find,d=Y.count,u=Y.checkIsExists,void 0!==r&&(v=r.valid,f=r.role,R=r.initData),void 0!==n&&(O=n.role),void 0!==a&&(E=a.valid,l=a.role),void 0!==s&&(C=s.role),void 0!==c&&(A=c.role),void 0!==d&&(N=d.role),void 0!==u&&(S=u.role)),e.getCreateValid=m=function(){return v},e.getUpdateValid=I=function(){return E},e.initData=_=function(o){return void 0!==R&&R(o),o},i.getDB=g=function(){return $},e.on=L=function(o,e){"create"===o?(void 0!==e.before&&F.push(e.before),void 0!==e.after&&G.push(e.after)):"get"===o?j.push(e):"update"===o?(void 0!==e.before&&q.push(e.before),void 0!==e.after&&w.push(e.after)):"remove"===o?(void 0!==e.before&&y.push(e.before),void 0!==e.after&&z.push(e.after)):"find"===o?J.push(e):"count"===o?Q.push(e):"checkIsExists"===o&&Z.push(e)},h=function(e,i,t){var r,n;_(e),void 0!==v&&(r=v.check(e)),void 0!==r&&r.checkHasError()===!0?i({validErrors:r.getErrors()}):NEXT([function(o){EACH(F,function(r){var a=r(e,i,o,t);n!==!0&&a===!1&&(n=!0)}),n!==!0&&o()},function(){return function(){$.create(e,{error:function(o){i({errorMsg:o})},success:function(e){EACH(G,function(o){o(e,t)}),o.BROADCAST({roomName:W+"/create",methodName:"create",data:e}),EACH(e,function(i,t){o.BROADCAST({roomName:W+"/"+t+"/"+i+"/create",methodName:"create",data:e})}),i({savedData:e})}})}}])},H=function(o,e,i){var t,r,n,a,s;CHECK_IS_DATA(o)!==!0?t=o:(t=o.id,r=o.filter,n=o.sort,a=o.isRandom),$.get({id:t,filter:r,sort:n,isRandom:a},{error:function(o){e({errorMsg:o})},notExists:function(){e()},success:function(o){EACH(j,function(t){var r=t(o,e,i);s!==!0&&r===!1&&(s=!0)}),s!==!0&&e({savedData:o})}})},M=function(e,i,t){var r,n,a=e.id;void 0!==E&&(r=E.checkExceptUndefined(e)),e.id=a,void 0!==r&&r.checkHasError()===!0?i({validErrors:r.getErrors()}):NEXT([function(o){EACH(q,function(r){var a=r(e,i,o,t);n!==!0&&a===!1&&(n=!0)}),n!==!0&&o()},function(){return function(){$.update(e,{error:function(o){i({errorMsg:o})},notExists:function(){i()},success:function(e){void 0!==e&&(EACH(w,function(o){o(e,t)}),o.BROADCAST({roomName:W+"/"+e.id,methodName:"update",data:e}),EACH(e,function(i,t){o.BROADCAST({roomName:W+"/"+t+"/"+i+"/update",methodName:"update",data:e})})),i({savedData:e})}})}}])},x=function(e,i,t){var r;NEXT([function(o){EACH(y,function(n){var a=n(e,i,o,t);r!==!0&&a===!1&&(r=!0)}),r!==!0&&o()},function(){return function(){$.remove(e,{error:function(o){i({errorMsg:o})},notExists:function(){i()},success:function(e){void 0!==e&&(EACH(z,function(o){o(e,t)}),o.BROADCAST({roomName:W+"/"+e.id,methodName:"remove",data:e}),EACH(e,function(i,t){o.BROADCAST({roomName:W+"/"+t+"/"+i+"/remove",methodName:"remove",data:e})})),i({savedData:e})}})}}])},T=function(o,e,i){var t,r,n,a,s,c;void 0!==o&&(t=o.filter,r=o.sort,n=INTEGER(o.start),a=INTEGER(o.count),s=o.isFindAll),$.find({filter:t,sort:r,start:n,count:a,isFindAll:s},{error:function(o){e({errorMsg:o})},success:function(o){EACH(J,function(t){var r=t(o,e,i);c!==!0&&r===!1&&(c=!0)}),c!==!0&&e({savedDataSet:o})}})},P=function(o,e,i){var t,r;void 0!==o&&(t=o.filter),$.count({filter:t},{error:function(o){e({errorMsg:o})},success:function(o){EACH(Q,function(t){var n=t(o,e,i);r!==!0&&n===!1&&(r=!0)}),r!==!0&&e({count:o})}})},p=function(o,e,i){var t,r;void 0!==o&&(t=o.filter),$.checkIsExists({filter:t},{error:function(o){e({errorMsg:o})},success:function(o){EACH(Z,function(){var t=Z(o,e,i);r!==!0&&t===!1&&(r=!0)}),r!==!0&&e({isExists:o})}})},r!==!1&&(i.create=b=function(e,i){var t,r,n;void 0!==i&&(CHECK_IS_DATA(i)!==!0?t=i:(t=i.success,r=i.notValid,n=i.error)),h(e,function(e){var i,a,s;void 0!==e?(i=e.errorMsg,a=e.validErrors,s=e.savedData,void 0!==i?void 0!==n?n(i):console.log(CONSOLE_RED("[UPPERCASE.IO-MODEL] `"+o.boxName+"."+W+".create` ERROR: "+i)):void 0!==a?void 0!==r?r(a):console.log(CONSOLE_YELLOW("[UPPERCASE.IO-MODEL] `"+o.boxName+"."+W+".create` NOT VALID."),a):void 0!==t&&t(s)):void 0!==t&&t()})}),n!==!1&&(i.get=K=function(e,i){var t,r,n;CHECK_IS_DATA(i)!==!0?t=i:(t=i.success,r=i.notExists,n=i.error),H(e,function(i){var a,s;void 0!==i&&(a=i.errorMsg,s=i.savedData),void 0!==a?void 0!==n?n(a):console.log(CONSOLE_RED("[UPPERCASE.IO-MODEL] `"+o.boxName+"."+W+".get` ERROR: "+a)):void 0===s?void 0!==r?r():console.log(CONSOLE_YELLOW("[UPPERCASE.IO-MODEL] `"+o.boxName+"."+W+".get` NOT EXISTS."),e):t(s)})}),a!==!1&&(i.update=U=function(e,i){var t,r,n,a;void 0!==i&&(CHECK_IS_DATA(i)!==!0?t=i:(t=i.success,r=i.notExists,n=i.notValid,a=i.error)),M(e,function(i){var s,c,d;void 0!==i&&(s=i.errorMsg,c=i.validErrors,d=i.savedData),void 0!==s?void 0!==a?a(s):console.log(CONSOLE_RED("[UPPERCASE.IO-MODEL] `"+o.boxName+"."+W+".update` ERROR: "+s)):void 0!==c?void 0!==n?n(c):console.log(CONSOLE_YELLOW("[UPPERCASE.IO-MODEL] `"+o.boxName+"."+W+".update` NOT VALID."),c):void 0===d?void 0!==r?r():console.log(CONSOLE_YELLOW("[UPPERCASE.IO-MODEL] `"+o.boxName+"."+W+".update` NOT EXISTS."),e):void 0!==t&&t(d)})}),s!==!1&&(i.remove=k=function(e,i){var t,r,n;void 0!==i&&(CHECK_IS_DATA(i)!==!0?t=i:(t=i.success,r=i.notExists,n=i.error)),x(e,function(i){var a,s;void 0!==i&&(a=i.errorMsg,s=i.savedData),void 0!==a?void 0!==n?n(a):console.log(CONSOLE_RED("[UPPERCASE.IO-MODEL] `"+o.boxName+"."+W+".remove` ERROR: "+a)):void 0===s?void 0!==r?r():console.log(CONSOLE_YELLOW("[UPPERCASE.IO-MODEL] `"+o.boxName+"."+W+".remove` NOT EXISTS."),e):void 0!==t&&t(s)})}),c!==!1&&(i.find=B=function(e,i){var t,r;void 0===i&&(i=e,e=void 0),void 0!==i&&(CHECK_IS_DATA(i)!==!0?t=i:(t=i.success,r=i.error)),T(e,function(e){var i=e.errorMsg,n=e.savedDataSet;void 0!==i?void 0!==r?r(i):console.log(CONSOLE_RED("[UPPERCASE.IO-MODEL] `"+o.boxName+"."+W+".find` ERROR: "+i)):t(n)})}),d!==!1&&(i.count=V=function(e,i){var t,r;void 0===i&&(i=e,e=void 0),void 0!==i&&(CHECK_IS_DATA(i)!==!0?t=i:(t=i.success,r=i.error)),P(e,function(e){var i=e.errorMsg,n=e.count;void 0!==i?void 0!==r?r(i):console.log(CONSOLE_RED("[UPPERCASE.IO-MODEL] `"+o.boxName+"."+W+".count` ERROR: "+i)):t(n)})}),u!==!1&&(i.checkIsExists=X=function(e,i){var t,r;void 0===i&&(i=e,e=void 0),void 0!==i&&(CHECK_IS_DATA(i)!==!0?t=i:(t=i.success,r=i.error)),p(e,function(e){var i=e.errorMsg,n=e.isExists;void 0!==i?void 0!==r?r(i):console.log(CONSOLE_RED("[UPPERCASE.IO-MODEL] `"+o.boxName+"."+W+".checkIsExists` ERROR: "+i)):t(n)})}),o.ROOM(W,function(o,e){r!==!1&&e("create",function(e,i){void 0===f||void 0!==o.roles&&CHECK_IS_IN({data:o.roles,value:f})===!0?h(e,i,o):i({isNotAuthed:!0})}),n!==!1&&e("get",function(e,i){void 0===O||void 0!==o.roles&&CHECK_IS_IN({data:o.roles,value:O})===!0?H(e,i,o):i({isNotAuthed:!0})}),a!==!1&&e("update",function(e,i){void 0===l||void 0!==o.roles&&CHECK_IS_IN({data:o.roles,value:l})===!0?M(e,i,o):i({isNotAuthed:!0})}),s!==!1&&e("remove",function(e,i){void 0===C||void 0!==o.roles&&CHECK_IS_IN({data:o.roles,value:C})===!0?x(e,i,o):i({isNotAuthed:!0})}),c!==!1&&e("find",function(e,i){void 0===A||void 0!==o.roles&&CHECK_IS_IN({data:o.roles,value:A})===!0?(void 0!==e&&delete e.isFindAll,T(e,i,o)):i({isNotAuthed:!0})}),d!==!1&&e("count",function(e,i){void 0===N||void 0!==o.roles&&CHECK_IS_IN({data:o.roles,value:N})===!0?P(e,i,o):i({isNotAuthed:!0})}),u!==!1&&e("checkIsExists",function(e,i){void 0===S||void 0!==o.roles&&CHECK_IS_IN({data:o.roles,value:S})===!0?p(e,i,o):i({isNotAuthed:!0})})})}})})});