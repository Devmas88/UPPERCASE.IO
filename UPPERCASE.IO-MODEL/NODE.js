FOR_BOX(function(o){"use strict";OVERRIDE(o.MODEL,function(){o.MODEL=CLASS({init:function(t,r,i){var e,n,a,c,d,u,v,s,f,E,C,A,S,m,D,_,h,l,g,H,I,T,N,M,O,p,R,x,K,X,k,B,b,L,V,U,F,P=i.name,j=i.config,q=[],w=[],y=[],z=[],G=[],J=[],Q=[],W=[],Y=[],Z=[],$=o.DB(P),ot=function(t){console.log(CONSOLE_RED("[UPPERCASE.IO-MODEL] `"+o.boxName+"."+P+"` ERROR: "+t))};r.getName=l=function(){return P},void 0!==j&&(e=j.create,n=j.get,a=j.update,c=j.remove,d=j.find,u=j.count,v=j.checkIsExists,void 0!==e&&(s=e.valid,E=e.role,h=e.initData),void 0!==n&&(C=n.role),void 0!==a&&(f=a.valid,A=a.role),void 0!==c&&(S=c.role),void 0!==d&&(m=d.role),void 0!==u&&(D=u.role),void 0!==v&&(_=v.role)),t.getCreateValid=g=function(){return s},t.getUpdateValid=H=function(){return f},t.initData=I=function(o){return void 0!==h&&h(o),o},r.getDB=T=function(){return $},t.on=N=function(o,t){"create"===o?(void 0!==t.before&&q.push(t.before),void 0!==t.after&&w.push(t.after)):"get"===o?y.push(t):"update"===o?(void 0!==t.before&&z.push(t.before),void 0!==t.after&&G.push(t.after)):"remove"===o?(void 0!==t.before&&J.push(t.before),void 0!==t.after&&Q.push(t.after)):"find"===o?W.push(t):"count"===o?Y.push(t):"checkIsExists"===o&&Z.push(t)},M=function(t,r,i){var e,n;I(t),REMOVE_TO_DELETE(t),void 0!==s&&(e=s.check({data:t})),void 0!==e&&e.checkHasError()===!0?r({validErrors:e.getErrors()}):NEXT([function(o){EACH(q,function(e){var a=e(t,r,o,i);n!==!0&&a===!1&&(n=!0)}),n!==!0&&o()},function(){return function(){$.create(t,{error:function(o){ot(o),r({errorMsg:o})},success:function(t){EACH(w,function(o){o(t,i)}),o.BROADCAST({roomName:P+"/create",methodName:"create",data:t}),EACH(t,function(r,i){o.BROADCAST({roomName:P+"/"+i+"/"+r+"/create",methodName:"create",data:t})}),r({savedData:t})}})}}])},O=function(o,t,r){var i;$.get(o,{error:function(o){ot(o),t({errorMsg:o})},notExists:function(){t()},success:function(o){EACH(y,function(e){var n=e(o,t,r);i!==!0&&n===!1&&(i=!0)}),i!==!0&&t({savedData:o})}})},p=function(t,r,i){var e,n;void 0!==f&&(e=f.check({data:t,isExceptUndefined:!0})),void 0!==e&&e.checkHasError()===!0?r({validErrors:e.getErrors()}):NEXT([function(o){EACH(z,function(e){var a=e(t,r,o,i);n!==!0&&a===!1&&(n=!0)}),n!==!0&&o()},function(){return function(){$.update(t,{error:function(o){ot(o),r({errorMsg:o})},notExists:function(){r()},success:function(t){void 0!==t&&(EACH(G,function(o){o(t,i)}),o.BROADCAST({roomName:P+"/"+t.id,methodName:"update",data:t}),EACH(t,function(r,i){o.BROADCAST({roomName:P+"/"+i+"/"+r+"/update",methodName:"update",data:t})})),r({savedData:t})}})}}])},R=function(t,r,i){var e;NEXT([function(o){EACH(J,function(n){var a=n(t,r,o,i);e!==!0&&a===!1&&(e=!0)}),e!==!0&&o()},function(){return function(){$.remove(t,{error:function(o){ot(o),r({errorMsg:o})},notExists:function(){r()},success:function(t){void 0!==t&&(EACH(Q,function(o){o(t,i)}),o.BROADCAST({roomName:P+"/"+t.id,methodName:"remove",data:t}),EACH(t,function(r,i){o.BROADCAST({roomName:P+"/"+i+"/"+r+"/remove",methodName:"remove",data:t})})),r({savedData:t})}})}}])},x=function(o,t,r){var i;$.find(o,{error:function(o){ot(o),t({errorMsg:o})},success:function(o){EACH(W,function(e){var n=e(o,t,r);i!==!0&&n===!1&&(i=!0)}),i!==!0&&t({savedDataSet:o})}})},K=function(o,t,r){var i;$.count(o,{error:function(o){ot(o),t({errorMsg:o})},success:function(o){EACH(Y,function(e){var n=e(o,t,r);i!==!0&&n===!1&&(i=!0)}),i!==!0&&t({count:o})}})},X=function(o,t,r){var i;$.checkIsExists(o,{error:function(o){ot(o),t({errorMsg:o})},success:function(o){EACH(Z,function(){var e=Z(o,t,r);i!==!0&&e===!1&&(i=!0)}),i!==!0&&t({isExists:o})}})},e!==!1&&(r.create=k=function(o,t){var r,i,e;void 0!==t&&(CHECK_IS_DATA(t)!==!0?r=t:(r=t.success,i=t.notValid,e=t.error)),M(o,function(o){var t=o.errorMsg,n=o.validErrors,a=o.savedData;void 0!==t?void 0!==e&&e(t):void 0!==n?void 0!==i&&i(n):void 0!==r&&r(a)})}),n!==!1&&(r.get=B=function(o,t){var r,i,e;void 0===t&&(t=o,o=void 0),CHECK_IS_DATA(t)!==!0?r=t:(r=t.success,i=t.notExists,e=t.error),O(o,function(o){var t=o.errorMsg,n=o.savedData;void 0!==o&&(t=o.errorMsg,n=o.savedData),void 0!==t?void 0!==e&&e(t):void 0===n?void 0!==i&&i():r(n)})}),a!==!1&&(r.update=b=function(o,t){var r,i,e,n;REMOVE_TO_DELETE(o),void 0!==t&&(CHECK_IS_DATA(t)!==!0?r=t:(r=t.success,i=t.notExists,e=t.notValid,n=t.error)),p(o,function(o){var t,a,c;void 0!==o&&(t=o.errorMsg,a=o.validErrors,c=o.savedData),void 0!==t?void 0!==n&&n(t):void 0!==a?void 0!==e&&e(a):void 0===c?void 0!==i&&i(a):void 0!==r&&r(c)})}),c!==!1&&(r.remove=L=function(o,t){var r,i,e;void 0!==t&&(CHECK_IS_DATA(t)!==!0?r=t:(r=t.success,i=t.notExists,e=t.error)),R(o,function(o){var t=o.errorMsg,n=o.savedData;void 0!==o&&(t=o.errorMsg,n=o.savedData),void 0!==t?void 0!==e&&e(t):void 0===n?void 0!==i&&i():void 0!==r&&r(n)})}),d!==!1&&(r.find=V=function(o,t){var r,i;void 0===t&&(t=o,o=void 0),void 0!==t&&(CHECK_IS_DATA(t)!==!0?r=t:(r=t.success,i=t.error)),x(o,function(o){var t=o.errorMsg,e=o.savedDataSet;void 0!==t?void 0!==i&&i(t):r(e)})}),u!==!1&&(r.count=U=function(o,t){var r,i;void 0===t&&(t=o,o=void 0),void 0!==t&&(CHECK_IS_DATA(t)!==!0?r=t:(r=t.success,i=t.error)),K(o,function(o){var t=o.errorMsg,e=o.count;void 0!==t?void 0!==i&&i(t):r(e)})}),v!==!1&&(r.checkIsExists=F=function(o,t){var r,i;void 0===t&&(t=o,o=void 0),void 0!==t&&(CHECK_IS_DATA(t)!==!0?r=t:(r=t.success,i=t.error)),X(o,function(o){var t=o.errorMsg,e=o.isExists;void 0!==t?void 0!==i&&i(t):r(e)})}),o.ROOM(P,function(o,t){var r=o.roles;void 0===r&&(r=o.roles=[]),e!==!1&&t("create",function(t,i){void 0===E||CHECK_IS_EXISTS({data:r,value:E})===!0?M(t,i,o):i({isNotAuthed:!0})}),n!==!1&&t("get",function(t,i){void 0===C||CHECK_IS_EXISTS({data:r,value:C})===!0?O(t,i,o):i({isNotAuthed:!0})}),a!==!1&&t("update",function(t,i){void 0===A||CHECK_IS_EXISTS({data:r,value:A})===!0?p(t,i,o):i({isNotAuthed:!0})}),c!==!1&&t("remove",function(t,i){void 0===S||CHECK_IS_EXISTS({data:r,value:S})===!0?R(t,i,o):i({isNotAuthed:!0})}),d!==!1&&t("find",function(t,i){void 0===m||CHECK_IS_EXISTS({data:r,value:m})===!0?(void 0!==t&&delete t.isFindAll,x(t,i,o)):i({isNotAuthed:!0})}),u!==!1&&t("count",function(i){t("remove",function(t,e){void 0===D||CHECK_IS_EXISTS({data:r,value:D})===!0?K(i,e,o):e({isNotAuthed:!0})})}),v!==!1&&t("checkIsExists",function(t,i){void 0===_||CHECK_IS_EXISTS({data:r,value:_})===!0?X(t,i,o):i({isNotAuthed:!0})})})}})})});