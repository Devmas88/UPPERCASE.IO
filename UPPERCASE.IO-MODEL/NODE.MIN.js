FOR_BOX(function(o){"use strict";OVERRIDE(o.MODEL,function(){o.MODEL=CLASS({init:function(e,i,t){var r,n,a,s,d,c,u,v,E,f,C,l,O,N,A,I,S,R,_,h,m,D,g,T,H,L,M,x,K,P,p,U,b,k,y,B,V,W,X,F,Y,G,j=t.name,$=t.initData,q=t.methodConfig,w=t.isNotUsingObjectId,z=t.isNotUsingHistory,J=[],Q=[],Z=[],oe=[],ee=[],ie=[],te=[],re=[],ne=[],ae=[],se=o.DB({name:j,isNotUsingObjectId:w,isNotUsingHistory:z});void 0!==q&&(r=q.create,n=q.get,a=q.update,s=q.remove,d=q.find,c=q.count,u=q.checkIsExists,void 0!==r&&(v=r.valid,f=r.role,h=r.authKey,S=r.adminRole),void 0!==n&&(C=n.role),void 0!==a&&(E=a.valid,l=a.role,m=a.authKey,R=a.adminRole),void 0!==s&&(O=s.role,D=s.authKey,_=s.adminRole),void 0!==d&&(N=d.role),void 0!==c&&(A=c.role),void 0!==u&&(I=u.role)),void 0!==CPU_CLUSTERING.getWorkerId()&&1!==CPU_CLUSTERING.getWorkerId()||void 0===$||RUN(function(){var e=[];EACH($,function(o,i){var t;void 0!==v&&v.getValidDataSet()[i].notEmpty===!0&&(t={},t[i]=TO_DELETE,e.push(t))}),se.find({filter:{$or:e},isFindAll:!0},EACH(function(e){console.log("[UPPERCASE.IO-MODEL] Found not inited data in `"+o.boxName+"."+j+"`.",e),EACH($,function(o,i){void 0===e[i]&&(e[i]=o)}),se.update(e)}))}),i.getName=g=function(){return j},e.getInitData=T=function(){return $},e.getCreateValid=H=function(){return v},e.getUpdateValid=L=function(){return E},i.getDB=M=function(){return se},e.on=x=function(o,e){"create"===o?(void 0!==e.before&&J.push(e.before),void 0!==e.after&&Q.push(e.after)):"get"===o?Z.push(e):"update"===o?(void 0!==e.before&&oe.push(e.before),void 0!==e.after&&ee.push(e.after)):"remove"===o?(void 0!==e.before&&ie.push(e.before),void 0!==e.after&&te.push(e.after)):"find"===o?re.push(e):"count"===o?ne.push(e):"checkIsExists"===o&&ae.push(e)},K=function(e,i,t){var r,n;void 0!==$&&EACH($,function(o,i){e[i]=o}),void 0!==v&&(r=v.check(e)),void 0!==r&&r.checkHasError()===!0?i({validErrors:r.getErrors()}):NEXT([function(o){EACH(J,function(r){var a=r(e,i,o,t);n!==!0&&a===!1&&(n=!0)}),n!==!0&&o()},function(){return function(){se.create(e,{error:function(o){i({errorMsg:o})},success:function(e){EACH(Q,function(o){o(e,t)}),o.BROADCAST({roomName:j+"/create",methodName:"create",data:e}),EACH(e,function(i,t){o.BROADCAST({roomName:j+"/"+t+"/"+i+"/create",methodName:"create",data:e})}),i({savedData:e})}})}}])},P=function(o,e,i){var t,r,n,a,s,d;CHECK_IS_DATA(o)!==!0?t=o:(t=o.id,r=o.filter,n=o.sort,a=o.isRandom,s=o.isToCache),se.get({id:t,filter:r,sort:n,isRandom:a,isToCache:s},{error:function(o){e({errorMsg:o})},notExists:function(){e()},success:function(o){EACH(Z,function(t){var r=t(o,e,i);d!==!0&&r===!1&&(d=!0)}),d!==!0&&e({savedData:o})}})},p=function(e,i,t){var r,n,a=e.id;void 0!==E&&(r=E.checkExceptUndefined(e)),e.id=a,void 0!==r&&r.checkHasError()===!0?i({validErrors:r.getErrors()}):NEXT([function(o){EACH(oe,function(r){var a=r(e,i,o,t);n!==!0&&a===!1&&(n=!0)}),n!==!0&&o()},function(){return function(){se.update(e,{error:function(o){i({errorMsg:o})},notExists:function(){i()},success:function(e){void 0!==e&&(EACH(ee,function(o){o(e,t)}),o.BROADCAST({roomName:j+"/"+e.id,methodName:"update",data:e}),EACH(e,function(i,t){o.BROADCAST({roomName:j+"/"+t+"/"+i+"/update",methodName:"update",data:e})})),i({savedData:e})}})}}])},U=function(e,i,t){var r;NEXT([function(o){EACH(ie,function(n){var a=n(e,i,o,t);r!==!0&&a===!1&&(r=!0)}),r!==!0&&o()},function(){return function(){se.remove(e,{error:function(o){i({errorMsg:o})},notExists:function(){i()},success:function(e){void 0!==e&&(EACH(te,function(o){o(e,t)}),o.BROADCAST({roomName:j+"/"+e.id,methodName:"remove",data:e}),EACH(e,function(i,t){o.BROADCAST({roomName:j+"/"+t+"/"+i+"/remove",methodName:"remove",data:e})})),i({savedData:e})}})}}])},b=function(o,e,i){var t,r,n,a,s,d,c;void 0!==o&&(t=o.filter,r=o.sort,n=INTEGER(o.start),a=INTEGER(o.count),s=o.isFindAll,d=o.isToCache),se.find({filter:t,sort:r,start:n,count:a,isFindAll:s,isToCache:d},{error:function(o){e({errorMsg:o})},success:function(o){EACH(re,function(t){var r=t(o,e,i);c!==!0&&r===!1&&(c=!0)}),c!==!0&&e({savedDataSet:o})}})},k=function(o,e,i){var t,r,n;void 0!==o&&(t=o.filter,r=o.isToCache),se.count({filter:t,isToCache:r},{error:function(o){e({errorMsg:o})},success:function(o){EACH(ne,function(t){var r=t(o,e,i);n!==!0&&r===!1&&(n=!0)}),n!==!0&&e({count:o})}})},y=function(o,e,i){var t,r,n;void 0!==o&&(t=o.filter,r=o.isToCache),se.checkIsExists({filter:t,isToCache:r},{error:function(o){e({errorMsg:o})},success:function(o){EACH(ae,function(){var t=ae(o,e,i);n!==!0&&t===!1&&(n=!0)}),n!==!0&&e({isExists:o})}})},i.create=B=function(e,i){var t,r,n;void 0!==i&&(CHECK_IS_DATA(i)!==!0?t=i:(t=i.success,r=i.notValid,n=i.error)),K(e,function(e){var i,a,s;void 0!==e?(i=e.errorMsg,a=e.validErrors,s=e.savedData,void 0!==i?void 0!==n?n(i):console.log(CONSOLE_RED("[UPPERCASE.IO-MODEL] `"+o.boxName+"."+j+"/create` ERROR: "+i)):void 0!==a?void 0!==r?r(a):console.log(CONSOLE_YELLOW("[UPPERCASE.IO-MODEL] `"+o.boxName+"."+j+"/create` NOT VALID."),a):void 0!==t&&t(s)):void 0!==t&&t()})},i.get=V=function(e,i){var t,r,n;CHECK_IS_DATA(i)!==!0?t=i:(t=i.success,r=i.notExists,n=i.error),P(e,function(i){var a,s;void 0!==i&&(a=i.errorMsg,s=i.savedData),void 0!==a?void 0!==n?n(a):console.log(CONSOLE_RED("[UPPERCASE.IO-MODEL] `"+o.boxName+"."+j+"/get` ERROR: "+a)):void 0===s?void 0!==r?r():console.log(CONSOLE_YELLOW("[UPPERCASE.IO-MODEL] `"+o.boxName+"."+j+"/get` NOT EXISTS."),e):t(s)})},i.update=W=function(e,i){var t,r,n,a;void 0!==i&&(CHECK_IS_DATA(i)!==!0?t=i:(t=i.success,r=i.notExists,n=i.notValid,a=i.error)),p(e,function(i){var s,d,c;void 0!==i&&(s=i.errorMsg,d=i.validErrors,c=i.savedData),void 0!==s?void 0!==a?a(s):console.log(CONSOLE_RED("[UPPERCASE.IO-MODEL] `"+o.boxName+"."+j+"/update` ERROR: "+s)):void 0!==d?void 0!==n?n(d):console.log(CONSOLE_YELLOW("[UPPERCASE.IO-MODEL] `"+o.boxName+"."+j+"/update` NOT VALID."),d):void 0===c?void 0!==r?r():console.log(CONSOLE_YELLOW("[UPPERCASE.IO-MODEL] `"+o.boxName+"."+j+"/update` NOT EXISTS."),e):void 0!==t&&t(c)})},w!==!0&&(i.remove=X=function(e,i){var t,r,n;void 0!==i&&(CHECK_IS_DATA(i)!==!0?t=i:(t=i.success,r=i.notExists,n=i.error)),U(e,function(i){var a,s;void 0!==i&&(a=i.errorMsg,s=i.savedData),void 0!==a?void 0!==n?n(a):console.log(CONSOLE_RED("[UPPERCASE.IO-MODEL] `"+o.boxName+"."+j+"/remove` ERROR: "+a)):void 0===s?void 0!==r?r():console.log(CONSOLE_YELLOW("[UPPERCASE.IO-MODEL] `"+o.boxName+"."+j+"/remove` NOT EXISTS."),e):void 0!==t&&t(s)})}),i.find=F=function(e,i){var t,r;void 0===i&&(i=e,e=void 0),void 0!==i&&(CHECK_IS_DATA(i)!==!0?t=i:(t=i.success,r=i.error)),b(e,function(e){var i=e.errorMsg,n=e.savedDataSet;void 0!==i?void 0!==r?r(i):console.log(CONSOLE_RED("[UPPERCASE.IO-MODEL] `"+o.boxName+"."+j+"/find` ERROR: "+i)):t(n)})},i.count=Y=function(e,i){var t,r;void 0===i&&(i=e,e=void 0),void 0!==i&&(CHECK_IS_DATA(i)!==!0?t=i:(t=i.success,r=i.error)),k(e,function(e){var i=e.errorMsg,n=e.count;void 0!==i?void 0!==r?r(i):console.log(CONSOLE_RED("[UPPERCASE.IO-MODEL] `"+o.boxName+"."+j+"/count` ERROR: "+i)):t(n)})},i.checkIsExists=G=function(e,i){var t,r;void 0===i&&(i=e,e=void 0),void 0!==i&&(CHECK_IS_DATA(i)!==!0?t=i:(t=i.success,r=i.error)),y(e,function(e){var i=e.errorMsg,n=e.isExists;void 0!==i?void 0!==r?r(i):console.log(CONSOLE_RED("[UPPERCASE.IO-MODEL] `"+o.boxName+"."+j+"/checkIsExists` ERROR: "+i)):t(n)})},o.ROOM(j,function(o,e){r!==!1&&e("create",function(e,i){void 0!==S?void 0===f||void 0!==o.roles&&CHECK_IS_IN({data:o.roles,value:S})===!0?K(e,i,o):i({isNotAuthed:!0}):void 0===f||void 0!==o.roles&&CHECK_IS_IN({data:o.roles,value:f})===!0?(void 0!==h&&(e[h]=o.authKey),K(e,i,o)):i({isNotAuthed:!0})}),n!==!1&&e("get",function(e,i){void 0===C||void 0!==o.roles&&CHECK_IS_IN({data:o.roles,value:C})===!0?(void 0!==e&&CHECK_IS_DATA(e)===!0&&delete e.isToCache,P(e,i,o)):i({isNotAuthed:!0})}),a!==!1&&e("update",function(e,i){void 0===l||void 0!==o.roles&&(CHECK_IS_IN({data:o.roles,value:l})===!0||CHECK_IS_IN({data:o.roles,value:R})===!0)?void 0!==m&&(void 0!==o.roles&&CHECK_IS_IN({data:o.roles,value:R})===!0)!=!0?se.get(e.id,{error:function(o){i({errorMsg:o})},notExists:function(){i()},success:function(t){t[m]===o.authKey?(e[m]=o.authKey,p(e,i,o)):i({isNotAuthed:!0})}}):p(e,i,o):i({isNotAuthed:!0})}),s!==!1&&w!==!0&&e("remove",function(e,i){void 0===O||void 0!==o.roles&&(CHECK_IS_IN({data:o.roles,value:O})===!0||CHECK_IS_IN({data:o.roles,value:_})===!0)?void 0!==D&&(void 0!==o.roles&&CHECK_IS_IN({data:o.roles,value:_})===!0)!=!0?se.get(e,{error:function(o){i({errorMsg:o})},notExists:function(){i()},success:function(t){t[D]===o.authKey?U(e,i,o):i({isNotAuthed:!0})}}):void 0===D&&void 0!==_?void 0!==o.roles&&CHECK_IS_IN({data:o.roles,value:_})===!0?U(e,i,o):i({isNotAuthed:!0}):U(e,i,o):i({isNotAuthed:!0})}),d!==!1&&e("find",function(e,i){void 0===N||void 0!==o.roles&&CHECK_IS_IN({data:o.roles,value:N})===!0?(void 0!==e&&(delete e.isFindAll,delete e.isToCache),b(e,i,o)):i({isNotAuthed:!0})}),c!==!1&&e("count",function(e,i){void 0===A||void 0!==o.roles&&CHECK_IS_IN({data:o.roles,value:A})===!0?(void 0!==e&&delete e.isToCache,k(e,i,o)):i({isNotAuthed:!0})}),u!==!1&&e("checkIsExists",function(e,i){void 0===I||void 0!==o.roles&&CHECK_IS_IN({data:o.roles,value:I})===!0?(void 0!==e&&delete e.isToCache,y(e,i,o)):i({isNotAuthed:!0})})})}})})});