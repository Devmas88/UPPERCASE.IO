FOR_BOX(function(a){"use strict";a.BROADCAST=METHOD({run:function(o){var m=a.boxName+"/"+o.roomName,t=o.methodName,d=o.data;LAUNCH_ROOM_SERVER.broadcast({roomName:m,methodName:t,data:d}),void 0!==CPU_CLUSTERING.broadcast&&CPU_CLUSTERING.broadcast({methodName:"__LAUNCH_ROOM_SERVER__MESSAGE",data:{roomName:m,methodName:t,data:d}}),void 0!==SERVER_CLUSTERING.broadcast&&SERVER_CLUSTERING.broadcast({methodName:"__LAUNCH_ROOM_SERVER__MESSAGE",data:{roomName:m,methodName:t,data:d}})}})});FOR_BOX(function(n){"use strict";n.ROOM=METHOD({run:function(O,R){LAUNCH_ROOM_SERVER.addInitRoomFunc(n.boxName+"/"+O,R)}})});global.LAUNCH_ROOM_SERVER=CLASS(function(t){"use strict";var o,n,E={},_={};return t.addInitRoomFunc=o=function(t,o){void 0===E[t]&&(E[t]=[]),E[t].push(o)},t.broadcast=n=function(t){var o=t.roomName,n=_[o];void 0!==n&&EACH(n,function(n){n({methodName:o+"/"+t.methodName,data:t.data})})},{init:function(t,o,e){var a,R;void 0!==CPU_CLUSTERING.on&&CPU_CLUSTERING.on("__LAUNCH_ROOM_SERVER__MESSAGE",n),void 0!==SERVER_CLUSTERING.on&&SERVER_CLUSTERING.on("__LAUNCH_ROOM_SERVER__MESSAGE",function(t){n(t),void 0!==CPU_CLUSTERING.broadcast&&CPU_CLUSTERING.broadcast({methodName:"__LAUNCH_ROOM_SERVER__MESSAGE",data:t})}),a=MULTI_PROTOCOL_SOCKET_SERVER(e,function(t,o,n,e){var a={};o("__ENTER_ROOM",function(R){var i=E[R],d=_[R];void 0===a[R]?(a[R]=1,void 0!==i&&EACH(i,function(E){E(t,function(t,n){o("__DISCONNECTED"===t?t:R+"/"+t,n)},function(t,o){n("__DISCONNECTED"===t?t:R+"/"+t,o)},function(t,o){e({methodName:R+"/"+t.methodName,data:t.data},o)})}),void 0===d&&(d=_[R]=[]),d.push(e)):a[R]+=1}),o("__EXIT_ROOM",function(t){void 0!==a[t]&&(a[t]-=1,0===a[t]&&(REMOVE({array:_[t],value:e}),0===_[t].length&&delete _[t],delete a[t]))}),o("__DISCONNECTED",function(){EACH(a,function(t,o){REMOVE({array:_[o],value:e}),0===_[o].length&&delete _[o]}),a=void 0})}),o.getWebSocketFixRequest=R=function(){return a.getWebSocketFixRequest()}}}});