global.BOOT=BOOT=function(params){"use strict";var fs=require("fs"),version=Date.now(),rootPath=process.cwd(),browserScript="global = window;\n",baseStyleCSS=fs.readFileSync(__dirname+"/BASE_STYLE.css").toString(),indexPageContent="",loadForNode=function(e){require(e)},loadForBrowser=function(e){browserScript+=fs.readFileSync(e).toString()+"\n"},loadForClient=function(e){loadForBrowser(e)},loadForCommon=function(e){loadForNode(e),loadForBrowser(e)},checkIsAllowedFolderName=function(e){return"."!==e[0]&&"node_modules"!==e&&"not_load"!==e&&"deprecated"!==e&&"_"!==e[0]},loadUJS,configuration,clustering,initBoxes,initDatabase,initModelSystem,loadAllScripts,generateIndexPage,run;loadUJS=function(){loadForCommon(__dirname+"/UPPERCASE.JS-COMMON.js"),loadForNode(__dirname+"/UPPERCASE.JS-NODE.js"),loadForBrowser(__dirname+"/UPPERCASE.JS-BROWSER.js"),browserScript+="BROWSER_CONFIG.fixScriptsFolderPath = '/UPPERCASE.IO/UPPERCASE.JS-BROWSER-FIX';\n",loadForBrowser(__dirname+"/UPPERCASE.IO-TRANSPORT/R/UPPERCASE.JS-BROWSER-FIX/FIX.js")},configuration=function(){var _CONFIG,_NODE_CONFIG,_BROWSER_CONFIG,stringifyJSONWithFunction=function(data){return JSON.stringify(data,function(e,t){return"function"==typeof t?"__THIS_IS_FUNCTION_START__"+t.toString()+"__THIS_IS_FUNCTION_END__":t},"	").replace(/("__THIS_IS_FUNCTION_START__(.*)__THIS_IS_FUNCTION_END__")/g,function(match,content){return eval("("+eval('"'+content.substring('"__THIS_IS_FUNCTION_START__'.length,content.length-'__THIS_IS_FUNCTION_END__"'.length)+'"')+")").toString()})};loadForCommon(__dirname+"/CONFIG.js"),CONFIG.version=version,browserScript+="CONFIG.version = "+version+"\n",void 0!==params&&(_CONFIG=params.CONFIG,_NODE_CONFIG=params.NODE_CONFIG,_BROWSER_CONFIG=params.BROWSER_CONFIG),void 0!==_CONFIG&&(EXTEND_DATA({origin:CONFIG,extend:_CONFIG}),browserScript+="EXTEND_DATA({ origin : CONFIG, extend : "+stringifyJSONWithFunction(_CONFIG)+" });\n"),void 0!==_NODE_CONFIG&&EXTEND_DATA({origin:NODE_CONFIG,extend:_NODE_CONFIG}),void 0!==_BROWSER_CONFIG&&(browserScript+="EXTEND_DATA({ origin : BROWSER_CONFIG, extend : "+stringifyJSONWithFunction(_BROWSER_CONFIG)+" });\n")},clustering=function(e){CPU_CLUSTERING(function(t){void 0!==NODE_CONFIG.serverClusteringHosts&&void 0!==NODE_CONFIG.serverClusteringPort?SERVER_CLUSTERING({hosts:NODE_CONFIG.serverClusteringHosts,port:NODE_CONFIG.serverClusteringPort},function(){e(t)}):e(t)})},initBoxes=function(){loadForCommon(__dirname+"/UPPERCASE.IO-BOX/CORE.js"),loadForBrowser(__dirname+"/UPPERCASE.IO-BOX/BROWSER.js"),fs.readdirSync(rootPath).forEach(function(e){fs.statSync(rootPath+"/"+e).isDirectory()===!0&&checkIsAllowedFolderName(e)===!0&&(BOX(e),browserScript+="BOX('"+e+"');\n")})},initDatabase=function(){loadForNode(__dirname+"/UPPERCASE.IO-DB/NODE.js"),void 0!==NODE_CONFIG.dbName&&CONNECT_TO_DB_SERVER({name:NODE_CONFIG.dbName,host:NODE_CONFIG.dbHost,port:NODE_CONFIG.dbPort,username:NODE_CONFIG.dbUsername,password:NODE_CONFIG.dbPassword})},initModelSystem=function(){loadForNode(__dirname+"/UPPERCASE.IO-TRANSPORT/NODE.js"),loadForBrowser(__dirname+"/UPPERCASE.IO-TRANSPORT/BROWSER.js"),browserScript+="BROWSER_CONFIG.transportFixScriptsFolderPath = '/UPPERCASE.IO';\n",loadForBrowser(__dirname+"/UPPERCASE.IO-TRANSPORT/R/FIX.js"),loadForNode(__dirname+"/UPPERCASE.IO-ROOM/NODE.js"),loadForClient(__dirname+"/UPPERCASE.IO-ROOM/CLIENT.js"),loadForBrowser(__dirname+"/UPPERCASE.IO-ROOM/BROWSER.js"),LAUNCH_ROOM_SERVER({socketServerPort:CONFIG.socketServerPort,webSocketServerPort:CONFIG.webSocketServerPort,webSocketFixServerPort:CONFIG.webSocketFixServerPort}),loadForCommon(__dirname+"/UPPERCASE.IO-MODEL/COMMON.js"),loadForNode(__dirname+"/UPPERCASE.IO-MODEL/NODE.js"),loadForClient(__dirname+"/UPPERCASE.IO-MODEL/CLIENT.js")},loadAllScripts=function(){var e=function(e,t){var o=function(e){var n;fs.existsSync(e)===!0&&(n=[],fs.readdirSync(e).forEach(function(o){var r=e+"/"+o;fs.statSync(r).isDirectory()===!0?checkIsAllowedFolderName(o)===!0&&n.push(r):t(r)}),EACH(n,function(e){o(e)}))};FOR_BOX(function(t){o(rootPath+"/"+t.boxName+"/"+e)})};e("COMMON",loadForCommon),e("NODE",loadForNode),e("BROWSER",loadForBrowser)},generateIndexPage=function(){indexPageContent+="<!DOCTYPE html>",indexPageContent+="<html>",indexPageContent+="<head>",indexPageContent+='<meta charset="utf-8">',indexPageContent+='<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no'+(CONFIG.isMobileFullScreen===!0?", minimal-ui":"")+'">',indexPageContent+='<meta name="google" value="notranslate">',void 0!==CONFIG.googleSiteVerificationKey&&(indexPageContent+='<meta name="google-site-verification" content="'+CONFIG.googleSiteVerificationKey+'" />'),indexPageContent+='<meta http-equiv="X-UA-Compatible" content="IE=Edge, chrome=1">',void 0!==CONFIG.description&&(indexPageContent+='<meta name="description" content="'+CONFIG.description+'">'),indexPageContent+='<link href="/favicon.ico" rel="shortcut icon">',indexPageContent+="<title>"+CONFIG.defaultTitle+"</title>",indexPageContent+='<link rel="stylesheet" type="text/css" href="__CSS?'+CONFIG.version+'" />',indexPageContent+="</head>",indexPageContent+="<body>",indexPageContent+="<noscript>",indexPageContent+='<p style="padding:15px;">',indexPageContent+="JavaScript is disabled. Please enable JavaScript in your browser.",indexPageContent+="</p>",indexPageContent+="</noscript>",indexPageContent+='<script type="text/javascript" src="__SCRIPT?'+CONFIG.version+'"></script>',indexPageContent+="</body>",indexPageContent+="</html>"},run=function(e){INIT_OBJECTS(),FOR_BOX(function(t){void 0!==t.MAIN&&t.MAIN(e)}),browserScript+=fs.readFileSync(__dirname+"/BROWSER_INIT.js").toString(),RESOURCE_SERVER({port:CONFIG.webServerPort,securedPort:CONFIG.sercuredWebServerPort,securedKeyFilePath:rootPath+"/"+NODE_CONFIG.securedKeyFilePath,securedCertFilePath:rootPath+"/"+NODE_CONFIG.securedCertFilePath,rootPath:rootPath,version:version},{requestListener:function(e,t,o,n){var r,i,a=e.uri;"__SCRIPT"===a?t({contentType:"text/javascript",content:browserScript}):"__CSS"===a?t({contentType:"text/css",content:baseStyleCSS}):e.isResponsed!==!0&&(i=a.indexOf("/"),-1===i?r=CONFIG.defaultBoxName:(r=a.substring(0,i),"UPPERCASE.IO"===r||void 0!==BOX.getBoxes()[r]?a=a.substring(i+1):r=CONFIG.defaultBoxName),"UPPERCASE.IO"===r?(n(__dirname+"/UPPERCASE.IO-TRANSPORT/R"),e.uri=a):e.uri=r+"/R"+(""===a?"":"/"+a))},notExists:function(e,t,o){t.uri===CONFIG.defaultBoxName+"/R"&&o({contentType:"text/html",content:indexPageContent})}}),console.log("[UPPERCASE.IO] `"+CONFIG.defaultTitle+"` WORKER #"+e.id+" (PID:"+e.pid+") BOOTed!"+(void 0===CONFIG.webServerPort?"":" => http://localhost:"+CONFIG.webServerPort)+(void 0===CONFIG.securedWebServerPort?"":" => https://localhost:"+CONFIG.securedWebServerPort))},loadUJS(),configuration(),clustering(function(e){loadForNode(__dirname+"/UPPERCASE.IO-UTIL/NODE.js"),initBoxes(),initDatabase(),initModelSystem(),loadAllScripts(),CONFIG.isDevMode!==!0&&(browserScript=MINIFY_JS(browserScript)),generateIndexPage(),run(e)})};