FOR_BOX(function(o){"use strict";o.MODEL=CLASS({init:function(i,t,e){var n,d,v,r,a,c,u,s,f,E,A,h,O,m,C,M,l,R,H,_,g,x,D,N,I,S,T,p,V,K,k,L=e.name,w=e.config,U=o.ROOM(L),W={},P={},b=[],B=[],F={},X=function(i){console.log("[UPPERCASE.IO-MODEL] `"+o.boxName+"."+L+"` ERROR: "+i)};t.getName=O=function(){return L},void 0!==w&&(n=w.create,d=w.get,v=w.update,r=w.remove,a=w.find,c=w.count,u=w.checkIsExists,void 0!==n&&(s=n.valid,E=n.initData),void 0!==v&&(f=v.valid)),i.getCreateValid=m=function(){return s},i.getUpdateValid=C=function(){return f},i.initData=M=function(o){return void 0!==E&&E(o),o},t.getRoom=l=function(){return U},n!==!1&&(t.create=R=function(o,i){var t,e,n,d,v;void 0!==M&&M(o),void 0!==i&&(CHECK_IS_DATA(i)!==!0?t=i:(t=i.success,e=i.notValid,n=i.notAuthed,d=i.error)),void 0!==s&&(v=s.check({data:o})),void 0!==v&&v.checkHasError()===!0?void 0!==e&&e(v.getErrors()):U.send({methodName:"create",data:o},function(o){var i=o.errorMsg,v=o.validErrors,r=o.isNotAuthed,a=o.savedData;void 0!==i?(X(i),void 0!==d&&d(i)):void 0!==v?void 0!==e&&e(v):r===!0?void 0!==n&&n():void 0!==t&&t(a)}),REMOVE_TO_DELETE(o)}),d!==!1&&(t.get=H=function(o,i){var t,e,n,d;void 0===i&&(i=o,o=void 0),CHECK_IS_DATA(i)!==!0?t=i:(t=i.success,e=i.notExists,n=i.notAuthed,d=i.error),U.send({methodName:"get",data:o},function(o){var i=o.errorMsg,v=o.isNotAuthed,r=o.savedData;void 0!==i?(X(i),void 0!==d&&d(i)):v===!0?void 0!==n&&n():void 0===r?void 0!==e&&e():void 0!==t&&t(r)})},t.getWatching=_=function(i,t){var e,n,d,v;void 0===t&&(t=i,i=void 0),CHECK_IS_DATA(t)!==!0?e=t:(e=t.success,n=t.notExists,d=t.notAuthed,v=t.error),H(i,{success:function(i){var t,n;void 0!==e&&(b.push(t=o.ROOM(L+"/"+i.id)),e(i,function(o){t.on("update",o)},function(o){t.on("remove",function(i){o(i),n()})},n=function(){REMOVE({data:b,value:t}),t.exit()}))},notExists:n,notAuthedHandler:d,errorHandler:v})}),v!==!1&&(t.update=g=function(o,i){var t,e,n,d,v,r;void 0!==i&&(CHECK_IS_DATA(i)!==!0?t=i:(t=i.success,e=i.notValid,n=i.notExists,d=i.notAuthed,v=i.error)),void 0!==f&&(r=f.check({data:o,isExceptUndefined:!0})),void 0!==f&&r.checkHasError()===!0?void 0!==e&&e(r.getErrors()):U.send({methodName:"update",data:o},function(o){var i=o.errorMsg,r=o.validErrors,a=o.isNotAuthed,c=o.savedData;void 0!==i?(X(i),void 0!==v&&v(i)):void 0!==r?void 0!==e&&e(r):a===!0?void 0!==d&&d():void 0===c?void 0!==n&&n():void 0!==t&&t(c)}),REMOVE_TO_DELETE(o)}),r!==!1&&(t.remove=x=function(o,i){var t,e,n,d;void 0!==i&&(CHECK_IS_DATA(i)!==!0?t=i:(t=i.success,e=i.notExists,n=i.notAuthed,d=i.error)),U.send({methodName:"remove",data:o},function(o){var i=o.errorMsg,v=o.isNotAuthed,r=o.savedData;void 0!==i?(X(i),void 0!==d&&d(i)):v===!0?void 0!==n&&n():void 0===r?void 0!==e&&e():void 0!==t&&t(r)})}),a!==!1&&(t.find=D=function(o,i){var t,e,n;void 0===i&&(i=o,o=void 0),void 0!==i&&(CHECK_IS_DATA(i)!==!0?t=i:(t=i.success,e=i.notAuthed,n=i.error)),U.send({methodName:"find",data:o},function(o){var i=o.errorMsg,d=o.isNotAuthed,v=o.savedDataSet;void 0!==i?(X(i),void 0!==n&&n(i)):d===!0?void 0!==e&&e():void 0!==t&&t(v)})},t.findWatching=N=function(i,t){var e,n,d;void 0===t&&(t=i,i=void 0),void 0!==t&&(CHECK_IS_DATA(t)!==!0?e=t:(e=t.success,n=t.notAuthed,d=t.error)),D(i,{success:function(i){var t,n={};void 0!==e&&(EACH(i,function(i){var t=i.id;b.push(n[t]=o.ROOM(L+"/"+t))}),e(i,function(o,i){n[o].on("update",i)},function(o,i){n[o].on("remove",function(e){i(e),t(o)})},t=function(o){void 0!==n[o]&&(REMOVE({data:b,value:n[o]}),n[o].exit(),delete n[o])}))},notAuthedHandler:n,errorHandler:d})}),c!==!1&&(t.count=I=function(o,i){var t,e,n;void 0===i&&(i=o,o=void 0),void 0!==i&&(CHECK_IS_DATA(i)!==!0?t=i:(t=i.success,e=i.notAuthed,n=i.error)),U.send({methodName:"count",data:o},function(o){var i=o.errorMsg,d=o.isNotAuthed,v=o.count;void 0!==i?(X(i),void 0!==n&&n(i)):d===!0?void 0!==e&&e():void 0!==t&&t(v)})}),u!==!1&&(t.checkIsExists=S=function(o,i){var t,e,n;void 0===i&&(i=o,o=void 0),void 0!==i&&(CHECK_IS_DATA(i)!==!0?t=i:(t=i.success,e=i.notAuthed,n=i.error)),U.send({methodName:"checkIsExists",data:o},function(o){var i=o.errorMsg,d=o.isNotAuthed,v=o.isExists;void 0!==i?(X(i),void 0!==n&&n(i)):d===!0?void 0!==e&&e():void 0!==t&&t(v)})}),t.onNew=T=function(i,t){var e=function(o){o.id;t(o)};void 0===t?(t=i,void 0===A&&(A=o.ROOM(L+"/create")),A.on("create",e)):EACH(i,function(i,t){var n=W[t+"/"+i];void 0===n&&(n=W[t+"/"+i]=o.ROOM(L+"/"+t+"/"+i+"/create")),n.on("create",e)})},t.onNewWatching=p=function(i,t){var e=function(i,e){var n,d,v=i.id;b.push(n=o.ROOM(L+"/"+v)),e.push(n),t(i,function(o){n.on("update",o)},function(o){n.on("remove",function(i){o(i),d()})},d=function(){n.exit(),REMOVE({data:b,value:n})})};void 0===t?(t=i,void 0===A&&(A=o.ROOM(L+"/create")),A.on("create",function(o){e(o,B)})):EACH(i,function(i,t){var n=W[t+"/"+i],d=F[t+"/"+i];void 0===n&&(n=W[t+"/"+i]=o.ROOM(L+"/"+t+"/"+i+"/create")),void 0===d&&(d=F[t+"/"+i]=[]),n.on("create",function(o){e(o,d)})})},t.closeOnNew=V=function(o){void 0===o?(void 0!==A&&(A.exit(),A=void 0),EACH(B,function(o){o.exit(),REMOVE({data:b,value:o})}),B=[]):EACH(o,function(o,i){void 0!==W[i+"/"+o]&&(W[i+"/"+o].exit(),delete W[i+"/"+o]),EACH(F[i+"/"+o],function(o){o.exit(),REMOVE({data:b,value:o})}),delete F[i+"/"+o]})},t.onRemove=K=function(i,t){var e=function(o){o.id;t(o)};void 0===t?(t=i,void 0===h&&(h=o.ROOM(L+"/remove")),h.on("remove",e)):EACH(i,function(i,t){var n=P[t+"/"+i];void 0===n&&(n=P[t+"/"+i]=o.ROOM(L+"/"+t+"/"+i+"/remove")),n.on("remove",e)})},t.closeOnRemove=k=function(o){void 0===o?void 0!==h&&(h.exit(),h=void 0):EACH(o,function(o,i){void 0!==P[i+"/"+o]&&(P[i+"/"+o].exit(),delete P[i+"/"+o])})}}})});