OVERRIDE(NODE_CONFIG,function(n){global.NODE_CONFIG=NODE_CONFIG=COMBINE([n,{maxUploadFileMB:10}])}),global.UPLOAD_REQUEST=UPLOAD_REQUEST=METHOD(function(){"use strict";var n=(require("fs"),require("formidable").IncomingForm);return{run:function(i,e){var o,t,r,u=i.requestInfo,E=i.uploadPath;CHECK_IS_DATA(e)!==!0?o=e:(o=e.success,t=e.error,r=e.overFileSize),CREATE_FOLDER(E,function(){var i,e,a,f=u.method,c=u.ip,s=u.nativeReq;"POST"===f&&(i=new n,e=[],a={},i.uploadDir=E,i.on("field",function(n,i){a[n]=i}).on("file",function(n,i){e.push({path:i.path,size:i.size,name:i.name,type:i.type,lastModifiedTime:i.lastModifiedDate})}).on("end",function(){NEXT(e,[function(n,i){var o=n.path,u=n.size;if(n.ip=c,u>1024*NODE_CONFIG.maxUploadFileMB*1024)return NEXT(e,[function(n,i){REMOVE_FILE(n.path,i)},function(){return function(){void 0!==r&&r()}}]),!1;EACH(a,function(i,e){""!==i.trim()&&(n[e]=i)});var E=n.type;"image/png"===E||"image/jpeg"===E||"image/gif"===E?IMAGEMAGICK_READ_METADATA(o,{error:function(){i(n)},success:function(e){void 0!==e.exif?(n.exif=e.exif,IMAGEMAGICK_CONVERT([o,"-auto-orient",o],{error:t,success:i})):i()}}):i()},function(){return function(){o(e)}}])}).on("error",function(n){var i=n.toString();console.log("[UPPERCASE.IO-UPLOAD_REQUEST] ERROR: "+i),void 0!==t&&t(i)}),i.parse(s))})}}});