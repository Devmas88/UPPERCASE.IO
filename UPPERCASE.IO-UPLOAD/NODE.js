OVERRIDE(NODE_CONFIG,function(e){global.NODE_CONFIG=NODE_CONFIG=COMBINE_DATA({origin:e,extend:{maxUploadFileMB:10}})}),global.UPLOAD_SERVER=UPLOAD_SERVER=METHOD(function(){"use strict";var e=(require("fs"),require("formidable").IncomingForm);return{run:function(o,i){var r,n,t,E,u,s,a,c,R=o.port,O=o.securedPort,f=o.securedKeyFilePath,d=o.securedCertFilePath,l=o.uploadPath;CHECK_IS_DATA(i)!==!0?n=i:(r=i.upload,CHECK_IS_DATA(r)!==!0?n=r:(n=r.success,t=r.error,E=r.overFileSize),u=i.serve,CHECK_IS_DATA(u)!==!0?s=u:(s=u.requestListener,a=u.error,c=u.notExistsResource)),CREATE_FOLDER(l,function(){RESOURCE_SERVER({port:R,securedPort:O,securedKeyFilePath:f,securedCertFilePath:d,rootPath:l,version:"FINAL",isNotParsingNativeReq:!0},{errorHandler:a,notExistsResource:c,requestListener:function(o,i,r,u,a,c){var R,O,f,d=o.method,A=o.ip,C=o.nativeReq;return"POST"===d?(R=new e,O=[],f={},R.uploadDir=l,R.on("field",function(e,o){f[e]=o}).on("file",function(e,o){O.push({path:o.path,size:o.size,name:o.name,type:o.type,lastModifiedTime:o.lastModifiedDate})}).on("end",function(){NEXT(O,[function(e,r){var n=e.path,u=e.size;if(e.ip=A,u>1024*NODE_CONFIG.maxUploadFileMB*1024)return void 0!==E?NEXT(O,[function(e,o){REMOVE_FILE(e.path,o)},function(){return function(){E(o,i)}}]):console.log(CONSOLE_YELLOW("[UPPERCASE.IO-UPLOAD_REQUEST] FILE SIZE IS TOO BIG!("+u+"):"+n)),!1;EACH(f,function(o,i){""!==o.trim()&&(e[i]=o)});var s=e.type;"image/png"===s||"image/jpeg"===s||"image/gif"===s?IMAGEMAGICK_READ_METADATA(n,{error:function(){r(e)},success:function(o){void 0!==o.exif?(e.exif=o.exif,IMAGEMAGICK_CONVERT([n,"-auto-orient",n],{error:t,success:r})):r()}}):r()},function(){return function(){n(O,o,i)}}])}).on("error",function(e){var o=e.toString();console.log("[UPPERCASE.IO-UPLOAD_REQUEST] ERROR: "+o),void 0!==t&&t(o)}),R.parse(C),!1):void 0!==s?s(o,i,r,u,a,c):void 0}}),console.log("[UPPERCASE.IO-UPLOAD_SERVER] RUNNING UPLOAD SERVER..."+(void 0===R?"":" (PORT:"+R+")")+(void 0===O?"":" (SECURED PORT:"+O+")"))})}}});