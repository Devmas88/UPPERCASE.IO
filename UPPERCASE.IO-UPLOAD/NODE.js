OVERRIDE(NODE_CONFIG,function(e){global.NODE_CONFIG=NODE_CONFIG=COMBINE_DATA({origin:e,extend:{maxUploadFileMB:10}})}),global.UPLOAD_SERVER=UPLOAD_SERVER=METHOD(function(){"use strict";var e=(require("fs"),require("formidable").IncomingForm);return{run:function(i,o){var r,n,t,E,u,s,a,c,R=i.port,O=i.securedPort,f=i.securedKeyFilePath,l=i.securedCertFilePath,d=i.uploadPath;CHECK_IS_DATA(o)!==!0?n=o:(r=o.upload,CHECK_IS_DATA(r)!==!0?n=r:(n=r.success,t=r.error,E=r.overFileSize),u=o.serve,CHECK_IS_DATA(u)!==!0?s=u:(s=u.requestListener,a=u.error,c=u.notExistsResource)),CREATE_FOLDER(d,function(){RESOURCE_SERVER({port:R,securedPort:O,securedKeyFilePath:f,securedCertFilePath:l,rootPath:d,isFinalResource:!0,isNotParsingNativeReq:!0},{errorHandler:a,notExistsResource:c,requestListener:function(i,o,r,u,a,c){var R,O,f,l=i.method,A=i.ip,C=i.nativeReq;return"POST"===l?(R=new e,O=[],f={},R.uploadDir=d,R.on("field",function(e,i){f[e]=i}).on("file",function(e,i){O.push({path:i.path,size:i.size,name:i.name,type:i.type,lastModifiedTime:i.lastModifiedDate})}).on("end",function(){NEXT(O,[function(e,r){var n=e.path,u=e.size;if(e.ip=A,u>1024*NODE_CONFIG.maxUploadFileMB*1024)return void 0!==E?NEXT(O,[function(e,i){REMOVE_FILE(e.path,i)},function(){return function(){E(i,o)}}]):console.log(CONSOLE_YELLOW("[UPPERCASE.IO-UPLOAD_REQUEST] FILE SIZE IS TOO BIG!("+u+"):"+n)),!1;EACH(f,function(i,o){""!==i.trim()&&(e[o]=i)});var s=e.type;"image/png"===s||"image/jpeg"===s||"image/gif"===s?IMAGEMAGICK_READ_METADATA(n,{error:function(){r(e)},success:function(i){void 0!==i.exif?(e.exif=i.exif,IMAGEMAGICK_CONVERT([n,"-auto-orient",n],{error:t,success:r})):r()}}):r()},function(){return function(){n(O,i,o)}}])}).on("error",function(e){var i=e.toString();console.log("[UPPERCASE.IO-UPLOAD_REQUEST] ERROR: "+i),void 0!==t&&t(i)}),R.parse(C),!1):void 0!==s?s(i,o,r,u,a,c):void 0}}),console.log("[UPPERCASE.IO-UPLOAD_SERVER] RUNNING UPLOAD SERVER..."+(void 0===R?"":" (PORT:"+R+")")+(void 0===O?"":" (SECURED PORT:"+O+")"))})}}});